/*
Navicat MySQL Data Transfer

Source Server         : localhost
Source Server Version : 50547
Source Host           : localhost:3306
Source Database       : chouchu

Target Server Type    : MYSQL
Target Server Version : 50547
File Encoding         : 65001

Date: 2016-11-11 16:29:54
*/

SET FOREIGN_KEY_CHECKS=0;

-- ----------------------------
-- Table structure for datatables_demo
-- ----------------------------
DROP TABLE IF EXISTS `datatables_demo`;
CREATE TABLE `datatables_demo` (
  `id` int(10) NOT NULL AUTO_INCREMENT,
  `first_name` varchar(250) NOT NULL DEFAULT '',
  `last_name` varchar(250) NOT NULL DEFAULT '',
  `position` varchar(250) NOT NULL DEFAULT '',
  `email` varchar(250) NOT NULL DEFAULT '',
  `office` varchar(250) NOT NULL DEFAULT '',
  `start_date` datetime DEFAULT NULL,
  `age` int(8) DEFAULT NULL,
  `salary` int(8) DEFAULT NULL,
  `seq` int(8) DEFAULT NULL,
  `extn` varchar(8) NOT NULL DEFAULT '',
  PRIMARY KEY (`id`),
  KEY `seq` (`seq`)
) ENGINE=InnoDB AUTO_INCREMENT=58 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of datatables_demo
-- ----------------------------
INSERT INTO `datatables_demo` VALUES ('1', 'Tiger', 'Nixon', 'System Architect', 't.nixon@datatables.net', 'Edinburgh', '2011-04-25 00:00:00', '61', '320800', '2', '5421');
INSERT INTO `datatables_demo` VALUES ('2', 'Garrett', 'Winters', 'Accountant', 'g.winters@datatables.net', 'Tokyo', '2011-07-25 00:00:00', '63', '170750', '22', '8422');
INSERT INTO `datatables_demo` VALUES ('3', 'Ashton', 'Cox', 'Junior Technical Author', 'a.cox@datatables.net', 'San Francisco', '2009-01-12 00:00:00', '66', '86000', '6', '1562');
INSERT INTO `datatables_demo` VALUES ('4', 'Cedric', 'Kelly', 'Senior Javascript Developer', 'c.kelly@datatables.net', 'Edinburgh', '2012-03-29 00:00:00', '22', '433060', '41', '6224');
INSERT INTO `datatables_demo` VALUES ('5', 'Airi', 'Satou', 'Accountant', 'a.satou@datatables.net', 'Tokyo', '2008-11-28 00:00:00', '33', '162700', '55', '5407');
INSERT INTO `datatables_demo` VALUES ('6', 'Brielle', 'Williamson', 'Integration Specialist', 'b.williamson@datatables.net', 'New York', '2012-12-02 00:00:00', '61', '372000', '21', '4804');
INSERT INTO `datatables_demo` VALUES ('7', 'Herrod', 'Chandler', 'Sales Assistant', 'h.chandler@datatables.net', 'San Francisco', '2012-08-06 00:00:00', '59', '137500', '46', '9608');
INSERT INTO `datatables_demo` VALUES ('8', 'Rhona', 'Davidson', 'Integration Specialist', 'r.davidson@datatables.net', 'Tokyo', '2010-10-14 00:00:00', '55', '327900', '50', '6200');
INSERT INTO `datatables_demo` VALUES ('9', 'Colleen', 'Hurst', 'Javascript Developer', 'c.hurst@datatables.net', 'San Francisco', '2009-09-15 00:00:00', '39', '205500', '26', '2360');
INSERT INTO `datatables_demo` VALUES ('10', 'Sonya', 'Frost', 'Software Engineer', 's.frost@datatables.net', 'Edinburgh', '2008-12-13 00:00:00', '23', '103600', '18', '1667');
INSERT INTO `datatables_demo` VALUES ('11', 'Jena', 'Gaines', 'Office Manager', 'j.gaines@datatables.net', 'London', '2008-12-19 00:00:00', '30', '90560', '13', '3814');
INSERT INTO `datatables_demo` VALUES ('12', 'Quinn', 'Flynn', 'Support Lead', 'q.flynn@datatables.net', 'Edinburgh', '2013-03-03 00:00:00', '22', '342000', '23', '9497');
INSERT INTO `datatables_demo` VALUES ('13', 'Charde', 'Marshall', 'Regional Director', 'c.marshall@datatables.net', 'San Francisco', '2008-10-16 00:00:00', '36', '470600', '14', '6741');
INSERT INTO `datatables_demo` VALUES ('14', 'Haley', 'Kennedy', 'Senior Marketing Designer', 'h.kennedy@datatables.net', 'London', '2012-12-18 00:00:00', '43', '313500', '12', '3597');
INSERT INTO `datatables_demo` VALUES ('15', 'Tatyana', 'Fitzpatrick', 'Regional Director', 't.fitzpatrick@datatables.net', 'London', '2010-03-17 00:00:00', '19', '385750', '54', '1965');
INSERT INTO `datatables_demo` VALUES ('16', 'Michael', 'Silva', 'Marketing Designer', 'm.silva@datatables.net', 'London', '2012-11-27 00:00:00', '66', '198500', '37', '1581');
INSERT INTO `datatables_demo` VALUES ('17', 'Paul', 'Byrd', 'Chief Financial Officer (CFO)', 'p.byrd@datatables.net', 'New York', '2010-06-09 00:00:00', '64', '725000', '32', '3059');
INSERT INTO `datatables_demo` VALUES ('18', 'Gloria', 'Little', 'Systems Administrator', 'g.little@datatables.net', 'New York', '2009-04-10 00:00:00', '59', '237500', '35', '1721');
INSERT INTO `datatables_demo` VALUES ('19', 'Bradley', 'Greer', 'Software Engineer', 'b.greer@datatables.net', 'London', '2012-10-13 00:00:00', '41', '132000', '48', '2558');
INSERT INTO `datatables_demo` VALUES ('20', 'Dai', 'Rios', 'Personnel Lead', 'd.rios@datatables.net', 'Edinburgh', '2012-09-26 00:00:00', '35', '217500', '45', '2290');
INSERT INTO `datatables_demo` VALUES ('21', 'Jenette', 'Caldwell', 'Development Lead', 'j.caldwell@datatables.net', 'New York', '2011-09-03 00:00:00', '30', '345000', '17', '1937');
INSERT INTO `datatables_demo` VALUES ('22', 'Yuri', 'Berry', 'Chief Marketing Officer (CMO)', 'y.berry@datatables.net', 'New York', '2009-06-25 00:00:00', '40', '675000', '57', '6154');
INSERT INTO `datatables_demo` VALUES ('23', 'Caesar', 'Vance', 'Pre-Sales Support', 'c.vance@datatables.net', 'New York', '2011-12-12 00:00:00', '21', '106450', '29', '8330');
INSERT INTO `datatables_demo` VALUES ('24', 'Doris', 'Wilder', 'Sales Assistant', 'd.wilder@datatables.net', 'Sidney', '2010-09-20 00:00:00', '23', '85600', '56', '3023');
INSERT INTO `datatables_demo` VALUES ('25', 'Angelica', 'Ramos', 'Chief Executive Officer (CEO)', 'a.ramos@datatables.net', 'London', '2009-10-09 00:00:00', '47', '1200000', '36', '5797');
INSERT INTO `datatables_demo` VALUES ('26', 'Gavin', 'Joyce', 'Developer', 'g.joyce@datatables.net', 'Edinburgh', '2010-12-22 00:00:00', '42', '92575', '5', '8822');
INSERT INTO `datatables_demo` VALUES ('27', 'Jennifer', 'Chang', 'Regional Director', 'j.chang@datatables.net', 'Singapore', '2010-11-14 00:00:00', '28', '357650', '51', '9239');
INSERT INTO `datatables_demo` VALUES ('28', 'Brenden', 'Wagner', 'Software Engineer', 'b.wagner@datatables.net', 'San Francisco', '2011-06-07 00:00:00', '28', '206850', '20', '1314');
INSERT INTO `datatables_demo` VALUES ('29', 'Fiona', 'Green', 'Chief Operating Officer (COO)', 'f.green@datatables.net', 'San Francisco', '2010-03-11 00:00:00', '48', '850000', '7', '2947');
INSERT INTO `datatables_demo` VALUES ('30', 'Shou', 'Itou', 'Regional Marketing', 's.itou@datatables.net', 'Tokyo', '2011-08-14 00:00:00', '20', '163000', '1', '8899');
INSERT INTO `datatables_demo` VALUES ('31', 'Michelle', 'House', 'Integration Specialist', 'm.house@datatables.net', 'Sidney', '2011-06-02 00:00:00', '37', '95400', '39', '2769');
INSERT INTO `datatables_demo` VALUES ('32', 'Suki', 'Burks', 'Developer', 's.burks@datatables.net', 'London', '2009-10-22 00:00:00', '53', '114500', '40', '6832');
INSERT INTO `datatables_demo` VALUES ('33', 'Prescott', 'Bartlett', 'Technical Author', 'p.bartlett@datatables.net', 'London', '2011-05-07 00:00:00', '27', '145000', '47', '3606');
INSERT INTO `datatables_demo` VALUES ('34', 'Gavin', 'Cortez', 'Team Leader', 'g.cortez@datatables.net', 'San Francisco', '2008-10-26 00:00:00', '22', '235500', '52', '2860');
INSERT INTO `datatables_demo` VALUES ('35', 'Martena', 'Mccray', 'Post-Sales support', 'm.mccray@datatables.net', 'Edinburgh', '2011-03-09 00:00:00', '46', '324050', '8', '8240');
INSERT INTO `datatables_demo` VALUES ('36', 'Unity', 'Butler', 'Marketing Designer', 'u.butler@datatables.net', 'San Francisco', '2009-12-09 00:00:00', '47', '85675', '24', '5384');
INSERT INTO `datatables_demo` VALUES ('37', 'Howard', 'Hatfield', 'Office Manager', 'h.hatfield@datatables.net', 'San Francisco', '2008-12-16 00:00:00', '51', '164500', '38', '7031');
INSERT INTO `datatables_demo` VALUES ('38', 'Hope', 'Fuentes', 'Secretary', 'h.fuentes@datatables.net', 'San Francisco', '2010-02-12 00:00:00', '41', '109850', '53', '6318');
INSERT INTO `datatables_demo` VALUES ('39', 'Vivian', 'Harrell', 'Financial Controller', 'v.harrell@datatables.net', 'San Francisco', '2009-02-14 00:00:00', '62', '452500', '30', '9422');
INSERT INTO `datatables_demo` VALUES ('40', 'Timothy', 'Mooney', 'Office Manager', 't.mooney@datatables.net', 'London', '2008-12-11 00:00:00', '37', '136200', '28', '7580');
INSERT INTO `datatables_demo` VALUES ('41', 'Jackson', 'Bradshaw', 'Director', 'j.bradshaw@datatables.net', 'New York', '2008-09-26 00:00:00', '65', '645750', '34', '1042');
INSERT INTO `datatables_demo` VALUES ('42', 'Olivia', 'Liang', 'Support Engineer', 'o.liang@datatables.net', 'Singapore', '2011-02-03 00:00:00', '64', '234500', '4', '2120');
INSERT INTO `datatables_demo` VALUES ('43', 'Bruno', 'Nash', 'Software Engineer', 'b.nash@datatables.net', 'London', '2011-05-03 00:00:00', '38', '163500', '3', '6222');
INSERT INTO `datatables_demo` VALUES ('44', 'Sakura', 'Yamamoto', 'Support Engineer', 's.yamamoto@datatables.net', 'Tokyo', '2009-08-19 00:00:00', '37', '139575', '31', '9383');
INSERT INTO `datatables_demo` VALUES ('45', 'Thor', 'Walton', 'Developer', 't.walton@datatables.net', 'New York', '2013-08-11 00:00:00', '61', '98540', '11', '8327');
INSERT INTO `datatables_demo` VALUES ('46', 'Finn', 'Camacho', 'Support Engineer', 'f.camacho@datatables.net', 'San Francisco', '2009-07-07 00:00:00', '47', '87500', '10', '2927');
INSERT INTO `datatables_demo` VALUES ('47', 'Serge', 'Baldwin', 'Data Coordinator', 's.baldwin@datatables.net', 'Singapore', '2012-04-09 00:00:00', '64', '138575', '44', '8352');
INSERT INTO `datatables_demo` VALUES ('48', 'Zenaida', 'Frank', 'Software Engineer', 'z.frank@datatables.net', 'New York', '2010-01-04 00:00:00', '63', '125250', '42', '7439');
INSERT INTO `datatables_demo` VALUES ('49', 'Zorita', 'Serrano', 'Software Engineer', 'z.serrano@datatables.net', 'San Francisco', '2012-06-01 00:00:00', '56', '115000', '27', '4389');
INSERT INTO `datatables_demo` VALUES ('50', 'Jennifer', 'Acosta', 'Junior Javascript Developer', 'j.acosta@datatables.net', 'Edinburgh', '2013-02-01 00:00:00', '43', '75650', '49', '3431');
INSERT INTO `datatables_demo` VALUES ('51', 'Cara', 'Stevens', 'Sales Assistant', 'c.stevens@datatables.net', 'New York', '2011-12-06 00:00:00', '46', '145600', '15', '3990');
INSERT INTO `datatables_demo` VALUES ('52', 'Hermione', 'Butler', 'Regional Director', 'h.butler@datatables.net', 'London', '2011-03-21 00:00:00', '47', '356250', '9', '1016');
INSERT INTO `datatables_demo` VALUES ('53', 'Lael', 'Greer', 'Systems Administrator', 'l.greer@datatables.net', 'London', '2009-02-27 00:00:00', '21', '103500', '25', '6733');
INSERT INTO `datatables_demo` VALUES ('54', 'Jonas', 'Alexander', 'Developer', 'j.alexander@datatables.net', 'San Francisco', '2010-07-14 00:00:00', '30', '86500', '33', '8196');
INSERT INTO `datatables_demo` VALUES ('55', 'Shad', 'Decker', 'Regional Director', 's.decker@datatables.net', 'Edinburgh', '2008-11-13 00:00:00', '51', '183000', '43', '6373');
INSERT INTO `datatables_demo` VALUES ('56', 'Michael', 'Bruce', 'Javascript Developer', 'm.bruce@datatables.net', 'Singapore', '2011-06-27 00:00:00', '29', '183000', '16', '5384');
INSERT INTO `datatables_demo` VALUES ('57', 'Donna', 'Snider', 'Customer Support', 'd.snider@datatables.net', 'New York', '2011-01-25 00:00:00', '27', '112000', '19', '4226');

-- ----------------------------
-- Table structure for sn_tasks
-- ----------------------------
DROP TABLE IF EXISTS `sn_tasks`;
CREATE TABLE `sn_tasks` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `cc_name` varchar(100) DEFAULT NULL,
  `ccbh` varchar(5) DEFAULT NULL,
  `fw_note` varchar(200) DEFAULT NULL,
  `cw_note` varchar(1000) DEFAULT NULL,
  `query_select` text NOT NULL,
  `query_a` text NOT NULL,
  `query_b` text NOT NULL,
  `delete_ab_bak` text,
  `back_ab` text,
  `query_d` text,
  `query_e` text,
  `query_f` text,
  `query_g` text,
  `query_h` text,
  `insert_d` text,
  `insert_e` text,
  `insert_f` text,
  `insert_g` text,
  `insert_h` text,
  `cwxz` varchar(12) DEFAULT NULL COMMENT '除外对象选择',
  `cwbh` varchar(12) DEFAULT NULL COMMENT '抽出编号',
  `blocks` varchar(30) DEFAULT NULL COMMENT 'block别',
  `run_block_validate` tinyint(1) DEFAULT NULL COMMENT '是否执行BLOCK别SQL验证',
  `create_time` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `status` varchar(1) DEFAULT '0' COMMENT '0：未执行， 1：已执行',
  `re-run-times` tinyint(4) DEFAULT NULL COMMENT '重复执行次数',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=41 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of sn_tasks
-- ----------------------------
INSERT INTO `sn_tasks` VALUES ('34', '抽出001', null, null, null, 'SELECT distinct \r\n   CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO))) AS SEQ, \r\n     A.SALONNO,A.HYNO,A.HYZB,A.HYM,A.HYMKN ,A.CHGRSLNO,ISNULL(C2.SLNMC,\'\')CHSLNMC,ISNULL(B.MC,\'\') ZS,\r\n    A.SNYR,ISNULL(D.ZJGRJE,\'\') ZJGRJE,ISNULL(D.ZJGRR,\'\') ZJGRR,isnull(c.SLNDELDT,\'\'),A.TEL,\r\n    a.QHYNO,A.QHYM,ISNULL(E.DLDLLQF,\'\') DLDLLQF ,\r\n    ISNULL(E.ZTQF,\'\') ZTQF ,ISNULL(E.PHASE,\'\') PHASE,E.CCBH,E.QHCALLRS,\r\n A.BLOCKNO,F.MC\r\nFROM  CALL010 A \r\nLEFT JOIN FMD010 A0 ON A.HYNO =A0.HYNO \r\nLEFT JOIN FMD080 B ON  A.DDFXBH=B.ID\r\nLEFT JOIN FMD070 C ON A.SALONNO=C.SLNCD\r\nLEFT JOIN FMD070 C2 ON A.CHGRSLNO =C2.SLNCD\r\nLEFT JOIN FMD060 D ON A.HYNO=D.HYNO \r\nLEFT JOIN FHD030 E ON A.HYNO=E.HYNO \r\nLEFT JOIN FMD110 F ON A.BLOCKNO = F.MCKEY AND F.GLBH = \'004\' \r\nWHERE ', '--抽出コード4639～4647の最新コール結果が「OK」と「不在」の方を抽出してしてください\r\nA.HYNO in \r\n(select  a.HYNO   from FHD010 a  \r\nleft join fhd030 b on a.hyno=b.hyno \r\nwhere a.ccbh between \'4639\' and \'4647\' and b.PHASE in (\'11\',\'13\')) \r\n                        ', '--②「除外」を除く \r\nAND ISNULL(A.HYNO,\'\') not in (select distinct HYNO from FMD200 )  \r\n--④元支店長、元サロン長、Ｂ会員、友の会会員(会員№4000000からの方）\r\nAND A.HYNO NOT IN ( SELECT DISTINCT SLNKAINO  FROM FMD070 WHERE  ISNULL(SLNDELDT,\'\')<>\'00000000\') \r\nAND A.HYZB<>\'B\' AND SUBSTRING (A.HYNO,1,1) <>\'4\'    \r\n--⑤2016年4月～現在まで購入のある方（直近購入） \r\nAND isnull(D.zjgrr,\'\') < \'20160401\'  \r\n--⑥80歳以上の方（1936年12月31日までに生まれた人） \r\nAND ISNULL(a.SNYR,\'\')>\'19361231\'  \r\n--⑦【岩手県青森県コール保留地域】\r\nAND ISNULL(A.HYNO,\'\') NOT IN (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'H49H\')   \r\n--⑪【東京】サロン№8631サロン光来の会員で地位ランク愛用者の方 \r\nand ISNULL(a.HYNO,\'\') not in (select HYNO from CALL010 where SALONNO=\'008631\' and XZDW = \'10\')\r\n--⑩【中部】サロン№９３０２サロン沖田の会員の方（全員） \r\n--⑨【北陸】サロン№5271サロンドムス所属の方 \r\n--⑬【北陸】サロン№516サロン金沢所属の方 \r\n--⑭【東北】サロン№6538サロン月花美人・サロン№7432サロン珊瑚美月・サロン№9272サロン夢花月　所属の方 \r\nand a.salonno not in (\'005271\',\'009302\',\'000516\',\'006538\',\'007432\',\'009272\') \r\n--⑧【北海道】会員№で依頼した方（除外対象追加　会員№553968髙橋敬子　除外してください）\r\n--⑫【東京】会員№8821（旧サロンゆめゆめ）の傘下の会員  \r\nand ISNULL(a.HYNO,\'\') not in (select distinct hyno from FMD180EXCEL2 where ccbh in (\'0059\',\'0054\'))  \r\nand ISNULL(a.HYNO,\'\')<>\'0553968\'\r\n--⑰会員の名前で名前の前に☆がついている会員 \r\nAND SUBSTRING ( rtrim(ltrim(A.HYM)),1,1)<>\'☆\'  \r\n--⑯868班､963班～996班、1037班～1070班の方\r\nAND ISNULL(a.HYNO,\'\') not IN (select HYNO from FHD010  where  BBH in (\'0868\') \r\nOR  BBH between \'963\' and \'996\' or BBH between \'1037\' and \'1070\' ) \r\n--⑯熊本県、大分県由布市在住の方 \r\nand a.HYNO not in ( select HYNO from ZK_DONOTDELETE where qf in(\'001\',\'008\'))\r\n                        ', null, null, '--D:①一度コールしたコール結果が「ＮＧ」の会員（「OK」、「不在」、「空白（NULL）」は抽出対象）\r\ndelete from FMD180EXCEL1 where ccbh =\'{$@_cwbh_@$}D\';\r\n--「OK」、「不在」、「空白（NULL）」は抽出対象（以外除外）\r\ninsert into FMD180EXCEL1(ccbh,HYNO)\r\nSELECT \'{$@_cwbh_@$}D\',A.HYNO\r\nfrom zkbak A \r\nleft join FHD030 B on A.HYNO =B.HYNO \r\nwhere ISNULL(b.ztqf,\'\') not in (\'\',\'1\',\'2\') ;\r\n\r\nselect B.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY B.SALONNO ORDER BY B.SALONNO, A.HYNO))) AS SEQ, A.HYNO,A.ztqf,A.phase,A.ccbh\r\nfrom FHD030 A\r\nLEFT JOIN CALL010 B ON A.HYNO=B.HYNO\r\nwhere A.HYNO in (SELECT DISTINCT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}D\')\r\n                        ', '--※　コール結果ＮＧ　状態区分：アプローチＯＫ，今回終了は抽出対象です  有这个,E不可执行.\r\n--E:コール結果「ＮＧ」、コール状態（「OK」、「不在」）除外\r\ninsert into FMD180EXCEL1(ccbh,HYNO)\r\nSELECT \'{$@_cwbh_@$}E\',A.HYNO\r\nfrom zkbak A \r\nleft join FHD030 B on A.HYNO =B.HYNO \r\nwhere isnull(b.ztqf,\'\')+ ISNULL (b.phase,\'\') in (\'112\',\'212\')\r\n\r\nselect B.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY B.SALONNO ORDER BY B.SALONNO, A.HYNO))) AS SEQ, A.HYNO,A.ztqf,A.phase,A.ccbh\r\nfrom FHD030 A\r\nLEFT JOIN CALL010 B ON A.HYNO=B.HYNO\r\nwhere A.HYNO in (SELECT DISTINCT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}E\')\r\n\r\n                        ', '--F:不備電話\r\ndelete from FMD180EXCEL1 where ccbh =\'{$@_cwbh_@$}F\';\r\ninsert into FMD180EXCEL1(ccbh,HYNO)\r\nselect \'{$@_cwbh_@$}F\' ,hyno \r\nfrom zkbak  where HYNO+REPLACE(rtrim(ltrim(REPLACE(tel,\'-\',\'\'))),\' \',\'\') \r\nin ((select [会員№]+REPLACE(rtrim(ltrim([電話番号（ハイフンなし）])),\' \',\'\')    \r\nfrom [不備電話$]));\r\n\r\nselect SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ,hyno ,TEL\r\nfrom call010 A\r\nwhere HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}F\')\r\nORDER BY SALONNO,HYNO \r\n                        ', '--Ｇ電話番号上にハイフンが２個以外\r\ndelete from FMD180EXCEL1 where ccbh =\'{$@_cwbh_@$}G\';\r\ninsert into FMD180EXCEL1(hyno,ccbh)\r\nSELECT HYNO,\'{$@_cwbh_@$}G\' FROM(\r\nSELECT (SELECT COUNT(1) FROM [dbo].[f_split](TEL,\'-\')) AS ID,* \r\nFROM zkbak ) TT WHERE TT.ID<>3 ;\r\n\r\nselect A.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ, A.hyno ,A.TEL\r\nfrom call010 A\r\nwhere A.HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}G\')\r\nORDER BY A.SALONNO,A.HYNO\r\n                        ', '--H 同一電番（名寄せ）の方\r\ndelete from FMD180EXCEL1 where ccbh =\'{$@_cwbh_@$}H\';\r\ninsert into FMD180EXCEL1(hyno,ccbh)\r\nSELECT  TT.HYNO,\'{$@_cwbh_@$}H\' FROM \r\n(SELECT C.HYNO,CASE WHEN ISNULL(D.TEL,\'\') = \'\' THEN C.TEL ELSE D.TEL END AS TEL FROM \r\n(SELECT DIS.* FROM \r\n(SELECT  V1.HYNO AS HYNO,V1.TEL AS TEL FROM \r\n(select HYNO,TEL from zkbak) V1 ) DIS ) C\r\nLEFT JOIN(SELECT HYNO,TEL,HYM FROM FHD030) D ON C.HYNO = D.HYNO ) TT\r\nWHERE REPLACE(TT.TEL,\'-\',\'\') IN (SELECT REPLACE(AA.TEL, \'-\', \'\')\r\nFROM (SELECT CASE WHEN ISNULL(B.TEL, \'\') = \'\' THEN A.TEL ELSE B.TEL END AS TEL\r\nFROM (SELECT DISTINCT  HYNO, TEL FROM \r\n(select HYNO,TEL from zkbak) TM ) A\r\nLEFT JOIN (SELECT HYNO,TEL FROM FHD030) B ON A.HYNO = B.HYNO ) AA\r\nWHERE ISNULL(AA.TEL, \'\') <> \'\'\r\nGROUP BY REPLACE(AA.TEL, \'-\', \'\')\r\nHAVING COUNT(AA.TEL) > 1)  \r\n                        ', null, null, null, null, null, 'D,E,F,G,H', 'V25', '', '0', '2016-11-03 12:35:58', '0', null);
INSERT INTO `sn_tasks` VALUES ('35', '抽出001', null, null, null, 'SELECT distinct \r\n   CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO))) AS SEQ, \r\n     A.SALONNO,A.HYNO,A.HYZB,A.HYM,A.HYMKN ,A.CHGRSLNO,ISNULL(C2.SLNMC,\'\')CHSLNMC,ISNULL(B.MC,\'\') ZS,\r\n    A.SNYR,ISNULL(D.ZJGRJE,\'\') ZJGRJE,ISNULL(D.ZJGRR,\'\') ZJGRR,isnull(c.SLNDELDT,\'\'),A.TEL,\r\n    a.QHYNO,A.QHYM,ISNULL(E.DLDLLQF,\'\') DLDLLQF ,\r\n    ISNULL(E.ZTQF,\'\') ZTQF ,ISNULL(E.PHASE,\'\') PHASE,E.CCBH,E.QHCALLRS,\r\n A.BLOCKNO,F.MC\r\nFROM  CALL010 A \r\nLEFT JOIN FMD010 A0 ON A.HYNO =A0.HYNO \r\nLEFT JOIN FMD080 B ON  A.DDFXBH=B.ID\r\nLEFT JOIN FMD070 C ON A.SALONNO=C.SLNCD\r\nLEFT JOIN FMD070 C2 ON A.CHGRSLNO =C2.SLNCD\r\nLEFT JOIN FMD060 D ON A.HYNO=D.HYNO \r\nLEFT JOIN FHD030 E ON A.HYNO=E.HYNO \r\nLEFT JOIN FMD110 F ON A.BLOCKNO = F.MCKEY AND F.GLBH = \'004\' \r\nWHERE ', '--抽出コード4639～4647の最新コール結果が「OK」と「不在」の方を抽出してしてください\r\nA.HYNO in \r\n(select  a.HYNO   from FHD010 a  \r\nleft join fhd030 b on a.hyno=b.hyno \r\nwhere a.ccbh between \'4639\' and \'4647\' and b.PHASE in (\'11\',\'13\')) \r\n                        ', '--②「除外」を除く \r\nAND ISNULL(A.HYNO,\'\') not in (select distinct HYNO from FMD200 )  \r\n--④元支店長、元サロン長、Ｂ会員、友の会会員(会員№4000000からの方）\r\nAND A.HYNO NOT IN ( SELECT DISTINCT SLNKAINO  FROM FMD070 WHERE  ISNULL(SLNDELDT,\'\')<>\'00000000\') \r\nAND A.HYZB<>\'B\' AND SUBSTRING (A.HYNO,1,1) <>\'4\'    \r\n--⑤2016年4月～現在まで購入のある方（直近購入） \r\nAND isnull(D.zjgrr,\'\') < \'20160401\'  \r\n--⑥80歳以上の方（1936年12月31日までに生まれた人） \r\nAND ISNULL(a.SNYR,\'\')>\'19361231\'  \r\n--⑦【岩手県青森県コール保留地域】\r\nAND ISNULL(A.HYNO,\'\') NOT IN (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'H49H\')   \r\n--⑪【東京】サロン№8631サロン光来の会員で地位ランク愛用者の方 \r\nand ISNULL(a.HYNO,\'\') not in (select HYNO from CALL010 where SALONNO=\'008631\' and XZDW = \'10\')\r\n--⑩【中部】サロン№９３０２サロン沖田の会員の方（全員） \r\n--⑨【北陸】サロン№5271サロンドムス所属の方 \r\n--⑬【北陸】サロン№516サロン金沢所属の方 \r\n--⑭【東北】サロン№6538サロン月花美人・サロン№7432サロン珊瑚美月・サロン№9272サロン夢花月　所属の方 \r\nand a.salonno not in (\'005271\',\'009302\',\'000516\',\'006538\',\'007432\',\'009272\') \r\n--⑧【北海道】会員№で依頼した方（除外対象追加　会員№553968髙橋敬子　除外してください）\r\n--⑫【東京】会員№8821（旧サロンゆめゆめ）の傘下の会員  \r\nand ISNULL(a.HYNO,\'\') not in (select distinct hyno from FMD180EXCEL2 where ccbh in (\'0059\',\'0054\'))  \r\nand ISNULL(a.HYNO,\'\')<>\'0553968\'\r\n--⑰会員の名前で名前の前に☆がついている会員 \r\nAND SUBSTRING ( rtrim(ltrim(A.HYM)),1,1)<>\'☆\'  \r\n--⑯868班､963班～996班、1037班～1070班の方\r\nAND ISNULL(a.HYNO,\'\') not IN (select HYNO from FHD010  where  BBH in (\'0868\') \r\nOR  BBH between \'963\' and \'996\' or BBH between \'1037\' and \'1070\' ) \r\n--⑯熊本県、大分県由布市在住の方 \r\nand a.HYNO not in ( select HYNO from ZK_DONOTDELETE where qf in(\'001\',\'008\'))\r\n                        ', null, null, '--D:①一度コールしたコール結果が「ＮＧ」の会員（「OK」、「不在」、「空白（NULL）」は抽出対象）\r\ndelete from FMD180EXCEL1 where ccbh =\'{$@_cwbh_@$}D\';\r\n--「OK」、「不在」、「空白（NULL）」は抽出対象（以外除外）\r\ninsert into FMD180EXCEL1(ccbh,HYNO)\r\nSELECT \'{$@_cwbh_@$}D\',A.HYNO\r\nfrom zkbak A \r\nleft join FHD030 B on A.HYNO =B.HYNO \r\nwhere ISNULL(b.ztqf,\'\') not in (\'\',\'1\',\'2\') ;\r\n\r\nselect B.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY B.SALONNO ORDER BY B.SALONNO, A.HYNO))) AS SEQ, A.HYNO,A.ztqf,A.phase,A.ccbh\r\nfrom FHD030 A\r\nLEFT JOIN CALL010 B ON A.HYNO=B.HYNO\r\nwhere A.HYNO in (SELECT DISTINCT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}D\')\r\n                        ', '--※　コール結果ＮＧ　状態区分：アプローチＯＫ，今回終了は抽出対象です  有这个,E不可执行.\r\n--E:コール結果「ＮＧ」、コール状態（「OK」、「不在」）除外\r\ninsert into FMD180EXCEL1(ccbh,HYNO)\r\nSELECT \'{$@_cwbh_@$}E\',A.HYNO\r\nfrom zkbak A \r\nleft join FHD030 B on A.HYNO =B.HYNO \r\nwhere isnull(b.ztqf,\'\')+ ISNULL (b.phase,\'\') in (\'112\',\'212\')\r\n\r\nselect B.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY B.SALONNO ORDER BY B.SALONNO, A.HYNO))) AS SEQ, A.HYNO,A.ztqf,A.phase,A.ccbh\r\nfrom FHD030 A\r\nLEFT JOIN CALL010 B ON A.HYNO=B.HYNO\r\nwhere A.HYNO in (SELECT DISTINCT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}E\')\r\n\r\n                        ', '--F:不備電話\r\ndelete from FMD180EXCEL1 where ccbh =\'{$@_cwbh_@$}F\';\r\ninsert into FMD180EXCEL1(ccbh,HYNO)\r\nselect \'{$@_cwbh_@$}F\' ,hyno \r\nfrom zkbak  where HYNO+REPLACE(rtrim(ltrim(REPLACE(tel,\'-\',\'\'))),\' \',\'\') \r\nin ((select [会員№]+REPLACE(rtrim(ltrim([電話番号（ハイフンなし）])),\' \',\'\')    \r\nfrom [不備電話$]));\r\n\r\nselect SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ,hyno ,TEL\r\nfrom call010 A\r\nwhere HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}F\')\r\nORDER BY SALONNO,HYNO \r\n                        ', '--Ｇ電話番号上にハイフンが２個以外\r\ndelete from FMD180EXCEL1 where ccbh =\'{$@_cwbh_@$}G\';\r\ninsert into FMD180EXCEL1(hyno,ccbh)\r\nSELECT HYNO,\'{$@_cwbh_@$}G\' FROM(\r\nSELECT (SELECT COUNT(1) FROM [dbo].[f_split](TEL,\'-\')) AS ID,* \r\nFROM zkbak ) TT WHERE TT.ID<>3 ;\r\n\r\nselect A.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ, A.hyno ,A.TEL\r\nfrom call010 A\r\nwhere A.HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}G\')\r\nORDER BY A.SALONNO,A.HYNO\r\n                        ', '--H 同一電番（名寄せ）の方\r\ndelete from FMD180EXCEL1 where ccbh =\'{$@_cwbh_@$}H\';\r\ninsert into FMD180EXCEL1(hyno,ccbh)\r\nSELECT  TT.HYNO,\'{$@_cwbh_@$}H\' FROM \r\n(SELECT C.HYNO,CASE WHEN ISNULL(D.TEL,\'\') = \'\' THEN C.TEL ELSE D.TEL END AS TEL FROM \r\n(SELECT DIS.* FROM \r\n(SELECT  V1.HYNO AS HYNO,V1.TEL AS TEL FROM \r\n(select HYNO,TEL from zkbak) V1 ) DIS ) C\r\nLEFT JOIN(SELECT HYNO,TEL,HYM FROM FHD030) D ON C.HYNO = D.HYNO ) TT\r\nWHERE REPLACE(TT.TEL,\'-\',\'\') IN (SELECT REPLACE(AA.TEL, \'-\', \'\')\r\nFROM (SELECT CASE WHEN ISNULL(B.TEL, \'\') = \'\' THEN A.TEL ELSE B.TEL END AS TEL\r\nFROM (SELECT DISTINCT  HYNO, TEL FROM \r\n(select HYNO,TEL from zkbak) TM ) A\r\nLEFT JOIN (SELECT HYNO,TEL FROM FHD030) B ON A.HYNO = B.HYNO ) AA\r\nWHERE ISNULL(AA.TEL, \'\') <> \'\'\r\nGROUP BY REPLACE(AA.TEL, \'-\', \'\')\r\nHAVING COUNT(AA.TEL) > 1)  \r\n                        ', null, null, null, null, null, 'D,E,F,G,H', 'V90', '', '0', '2016-11-09 13:06:23', '1', null);
INSERT INTO `sn_tasks` VALUES ('36', '', null, null, null, 'SELECT distinct \r\n   CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO))) AS SEQ, \r\n     A.SALONNO,A.HYNO,A.HYZB,A.HYM,A.HYMKN ,A.CHGRSLNO,ISNULL(C2.SLNMC,\'\')CHSLNMC,ISNULL(B.MC,\'\') ZS,\r\n    A.SNYR,ISNULL(D.ZJGRJE,\'\') ZJGRJE,ISNULL(D.ZJGRR,\'\') ZJGRR,isnull(c.SLNDELDT,\'\'),A.TEL,\r\n    a.QHYNO,A.QHYM,ISNULL(E.DLDLLQF,\'\') DLDLLQF ,\r\n    ISNULL(E.ZTQF,\'\') ZTQF ,ISNULL(E.PHASE,\'\') PHASE,E.CCBH,E.QHCALLRS,\r\n A.BLOCKNO,F.MC\r\nFROM  CALL010 A \r\nLEFT JOIN FMD010 A0 ON A.HYNO =A0.HYNO \r\nLEFT JOIN FMD080 B ON  A.DDFXBH=B.ID\r\nLEFT JOIN FMD070 C ON A.SALONNO=C.SLNCD\r\nLEFT JOIN FMD070 C2 ON A.CHGRSLNO =C2.SLNCD\r\nLEFT JOIN FMD060 D ON A.HYNO=D.HYNO \r\nLEFT JOIN FHD030 E ON A.HYNO=E.HYNO \r\nLEFT JOIN FMD110 F ON A.BLOCKNO = F.MCKEY AND F.GLBH = \'004\' \r\nWHERE ', '--抽出コード4639～4647の最新コール結果が「OK」と「不在」の方を抽出してしてください\r\nA.HYNO in \r\n(select  a.HYNO   from FHD010 a  \r\nleft join fhd030 b on a.hyno=b.hyno \r\nwhere a.ccbh between \'4639\' and \'4647\' and b.PHASE in (\'11\',\'13\')) \r\n                        ', '--②「除外」を除く \r\nAND ISNULL(A.HYNO,\'\') not in (select distinct HYNO from FMD200 )  \r\n--④元支店長、元サロン長、Ｂ会員、友の会会員(会員№4000000からの方）\r\nAND A.HYNO NOT IN ( SELECT DISTINCT SLNKAINO  FROM FMD070 WHERE  ISNULL(SLNDELDT,\'\')<>\'00000000\') \r\nAND A.HYZB<>\'B\' AND SUBSTRING (A.HYNO,1,1) <>\'4\'    \r\n--⑤2016年4月～現在まで購入のある方（直近購入） \r\nAND isnull(D.zjgrr,\'\') < \'20160401\'  \r\n--⑥80歳以上の方（1936年12月31日までに生まれた人） \r\nAND ISNULL(a.SNYR,\'\')>\'19361231\'  \r\n--⑦【岩手県青森県コール保留地域】\r\nAND ISNULL(A.HYNO,\'\') NOT IN (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'H49H\')   \r\n--⑪【東京】サロン№8631サロン光来の会員で地位ランク愛用者の方 \r\nand ISNULL(a.HYNO,\'\') not in (select HYNO from CALL010 where SALONNO=\'008631\' and XZDW = \'10\')\r\n--⑩【中部】サロン№９３０２サロン沖田の会員の方（全員） \r\n--⑨【北陸】サロン№5271サロンドムス所属の方 \r\n--⑬【北陸】サロン№516サロン金沢所属の方 \r\n--⑭【東北】サロン№6538サロン月花美人・サロン№7432サロン珊瑚美月・サロン№9272サロン夢花月　所属の方 \r\nand a.salonno not in (\'005271\',\'009302\',\'000516\',\'006538\',\'007432\',\'009272\') \r\n--⑧【北海道】会員№で依頼した方（除外対象追加　会員№553968髙橋敬子　除外してください）\r\n--⑫【東京】会員№8821（旧サロンゆめゆめ）の傘下の会員  \r\nand ISNULL(a.HYNO,\'\') not in (select distinct hyno from FMD180EXCEL2 where ccbh in (\'0059\',\'0054\'))  \r\nand ISNULL(a.HYNO,\'\')<>\'0553968\'\r\n--⑰会員の名前で名前の前に☆がついている会員 \r\nAND SUBSTRING ( rtrim(ltrim(A.HYM)),1,1)<>\'☆\'  \r\n--⑯868班､963班～996班、1037班～1070班の方\r\nAND ISNULL(a.HYNO,\'\') not IN (select HYNO from FHD010  where  BBH in (\'0868\') \r\nOR  BBH between \'963\' and \'996\' or BBH between \'1037\' and \'1070\' ) \r\n--⑯熊本県、大分県由布市在住の方 \r\nand a.HYNO not in ( select HYNO from ZK_DONOTDELETE where qf in(\'001\',\'008\'))\r\n                        ', null, null, 'select B.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY B.SALONNO ORDER BY B.SALONNO, A.HYNO))) AS SEQ, A.HYNO,A.ztqf,A.phase,A.ccbh\r\nfrom FHD030 A\r\nLEFT JOIN CALL010 B ON A.HYNO=B.HYNO\r\nwhere A.HYNO in (SELECT DISTINCT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}D\')\r\n                        ', 'select B.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY B.SALONNO ORDER BY B.SALONNO, A.HYNO))) AS SEQ, A.HYNO,A.ztqf,A.phase,A.ccbh\r\nfrom FHD030 A\r\nLEFT JOIN CALL010 B ON A.HYNO=B.HYNO\r\nwhere A.HYNO in (SELECT DISTINCT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}E\')\r\n                        ', 'select SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ,hyno ,TEL\r\nfrom call010 A\r\nwhere HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}F\')\r\nORDER BY SALONNO,HYNO \r\n                        ', 'select A.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ, A.hyno ,A.TEL\r\nfrom call010 A\r\nwhere A.HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}G\')\r\nORDER BY A.SALONNO,A.HYNO\r\n                        ', 'select A.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ, A.hyno ,A.TEL\r\nfrom call010 A\r\nwhere A.HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'V25H\')\r\nORDER BY A.SALONNO,A.HYNO\r\n                        ', 'insert into FMD180EXCEL1(ccbh,HYNO)\r\nSELECT \'{$@_cwbh_@$}D\',A.HYNO\r\nfrom zkbak A \r\nleft join FHD030 B on A.HYNO =B.HYNO \r\nwhere ISNULL(b.ztqf,\'\') not in (\'\',\'1\',\'2\') ;\r\n                        ', 'insert into FMD180EXCEL1(ccbh,HYNO)\r\nSELECT \'{$@_cwbh_@$}E\',A.HYNO\r\nfrom zkbak A \r\nleft join FHD030 B on A.HYNO =B.HYNO \r\nwhere isnull(b.ztqf,\'\')+ ISNULL (b.phase,\'\') in (\'112\',\'212\')\r\n                        ', 'insert into FMD180EXCEL1(ccbh,HYNO)\r\nselect \'{$@_cwbh_@$}F\' ,hyno \r\nfrom zkbak  where HYNO+REPLACE(rtrim(ltrim(REPLACE(tel,\'-\',\'\'))),\' \',\'\') \r\nin ((select [会員№]+REPLACE(rtrim(ltrim([電話番号（ハイフンなし）])),\' \',\'\')    \r\nfrom [不備電話$]));\r\n                        ', 'insert into FMD180EXCEL1(hyno,ccbh)\r\nSELECT HYNO,\'{$@_cwbh_@$}G\' FROM(\r\nSELECT (SELECT COUNT(1) FROM [dbo].[f_split](TEL,\'-\')) AS ID,* \r\nFROM zkbak ) TT WHERE TT.ID<>3 ;\r\n                        ', 'insert into FMD180EXCEL1(hyno,ccbh)\r\nSELECT  TT.HYNO,\'V25H\' FROM \r\n(SELECT C.HYNO,CASE WHEN ISNULL(D.TEL,\'\') = \'\' THEN C.TEL ELSE D.TEL END AS TEL FROM \r\n(SELECT DIS.* FROM \r\n(SELECT  V1.HYNO AS HYNO,V1.TEL AS TEL FROM \r\n(select HYNO,TEL from zkbak) V1 ) DIS ) C\r\nLEFT JOIN(SELECT HYNO,TEL,HYM FROM FHD030) D ON C.HYNO = D.HYNO ) TT\r\nWHERE REPLACE(TT.TEL,\'-\',\'\') IN (SELECT REPLACE(AA.TEL, \'-\', \'\')\r\nFROM (SELECT CASE WHEN ISNULL(B.TEL, \'\') = \'\' THEN A.TEL ELSE B.TEL END AS TEL\r\nFROM (SELECT DISTINCT  HYNO, TEL FROM \r\n(select HYNO,TEL from zkbak) TM ) A\r\nLEFT JOIN (SELECT HYNO,TEL FROM FHD030) B ON A.HYNO = B.HYNO ) AA\r\nWHERE ISNULL(AA.TEL, \'\') <> \'\'\r\nGROUP BY REPLACE(AA.TEL, \'-\', \'\')\r\nHAVING COUNT(AA.TEL) > 1)  \r\n                        ', 'D,E,F,G,H', 'V25', '', '0', '2016-11-04 15:29:00', '0', null);
INSERT INTO `sn_tasks` VALUES ('37', '', null, null, null, 'SELECT distinct \r\n   CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO))) AS SEQ, \r\n     A.SALONNO,A.HYNO,A.HYZB,A.HYM,A.HYMKN ,A.CHGRSLNO,ISNULL(C2.SLNMC,\'\')CHSLNMC,ISNULL(B.MC,\'\') ZS,\r\n    A.SNYR,ISNULL(D.ZJGRJE,\'\') ZJGRJE,ISNULL(D.ZJGRR,\'\') ZJGRR,isnull(c.SLNDELDT,\'\'),A.TEL,\r\n    a.QHYNO,A.QHYM,ISNULL(E.DLDLLQF,\'\') DLDLLQF ,\r\n    ISNULL(E.ZTQF,\'\') ZTQF ,ISNULL(E.PHASE,\'\') PHASE,E.CCBH,E.QHCALLRS,\r\n A.BLOCKNO,F.MC\r\nFROM  CALL010 A \r\nLEFT JOIN FMD010 A0 ON A.HYNO =A0.HYNO \r\nLEFT JOIN FMD080 B ON  A.DDFXBH=B.ID\r\nLEFT JOIN FMD070 C ON A.SALONNO=C.SLNCD\r\nLEFT JOIN FMD070 C2 ON A.CHGRSLNO =C2.SLNCD\r\nLEFT JOIN FMD060 D ON A.HYNO=D.HYNO \r\nLEFT JOIN FHD030 E ON A.HYNO=E.HYNO \r\nLEFT JOIN FMD110 F ON A.BLOCKNO = F.MCKEY AND F.GLBH = \'004\' \r\nWHERE ', '--抽出コード4639～4647の最新コール結果が「OK」と「不在」の方を抽出してしてください\r\nA.HYNO in \r\n(select  a.HYNO   from FHD010 a  \r\nleft join fhd030 b on a.hyno=b.hyno \r\nwhere a.ccbh between \'4639\' and \'4647\' and b.PHASE in (\'11\',\'13\')) \r\n                        ', '--②「除外」を除く \r\nAND ISNULL(A.HYNO,\'\') not in (select distinct HYNO from FMD200 )  \r\n--④元支店長、元サロン長、Ｂ会員、友の会会員(会員№4000000からの方）\r\nAND A.HYNO NOT IN ( SELECT DISTINCT SLNKAINO  FROM FMD070 WHERE  ISNULL(SLNDELDT,\'\')<>\'00000000\') \r\nAND A.HYZB<>\'B\' AND SUBSTRING (A.HYNO,1,1) <>\'4\'    \r\n--⑤2016年4月～現在まで購入のある方（直近購入） \r\nAND isnull(D.zjgrr,\'\') < \'20160401\'  \r\n--⑥80歳以上の方（1936年12月31日までに生まれた人） \r\nAND ISNULL(a.SNYR,\'\')>\'19361231\'  \r\n--⑦【岩手県青森県コール保留地域】\r\nAND ISNULL(A.HYNO,\'\') NOT IN (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'H49H\')   \r\n--⑪【東京】サロン№8631サロン光来の会員で地位ランク愛用者の方 \r\nand ISNULL(a.HYNO,\'\') not in (select HYNO from CALL010 where SALONNO=\'008631\' and XZDW = \'10\')\r\n--⑩【中部】サロン№９３０２サロン沖田の会員の方（全員） \r\n--⑨【北陸】サロン№5271サロンドムス所属の方 \r\n--⑬【北陸】サロン№516サロン金沢所属の方 \r\n--⑭【東北】サロン№6538サロン月花美人・サロン№7432サロン珊瑚美月・サロン№9272サロン夢花月　所属の方 \r\nand a.salonno not in (\'005271\',\'009302\',\'000516\',\'006538\',\'007432\',\'009272\') \r\n--⑧【北海道】会員№で依頼した方（除外対象追加　会員№553968髙橋敬子　除外してください）\r\n--⑫【東京】会員№8821（旧サロンゆめゆめ）の傘下の会員  \r\nand ISNULL(a.HYNO,\'\') not in (select distinct hyno from FMD180EXCEL2 where ccbh in (\'0059\',\'0054\'))  \r\nand ISNULL(a.HYNO,\'\')<>\'0553968\'\r\n--⑰会員の名前で名前の前に☆がついている会員 \r\nAND SUBSTRING ( rtrim(ltrim(A.HYM)),1,1)<>\'☆\'  \r\n--⑯868班､963班～996班、1037班～1070班の方\r\nAND ISNULL(a.HYNO,\'\') not IN (select HYNO from FHD010  where  BBH in (\'0868\') \r\nOR  BBH between \'963\' and \'996\' or BBH between \'1037\' and \'1070\' ) \r\n--⑯熊本県、大分県由布市在住の方 \r\nand a.HYNO not in ( select HYNO from ZK_DONOTDELETE where qf in(\'001\',\'008\'))\r\n                        ', 'DELETE ZKBAK ;\r\n                        ', 'INSERT INTO ZKBAK(BBH,HYNO,TEL,CCBH)\r\nSELECT    distinct \'zk\',a.HYNO AS HYNO,A.TEL AS TEL,a.blockno\r\nFROM CALL010 a \r\nLEFT JOIN FMD060 D ON A.HYNO=D.HYNO \r\nLEFT JOIN FMD070 c ON A.SALONNO =c.SLNCD \r\nleft join FHD030 E on a.HYNO=E.HYNO \r\nLEFT JOIN FMD010 A0 ON A.HYNO =A0.HYNO \r\nWHERE \r\n--查询范围\r\n--除外条件\r\n                        ', 'select B.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY B.SALONNO ORDER BY B.SALONNO, A.HYNO))) AS SEQ, A.HYNO,A.ztqf,A.phase,A.ccbh\r\nfrom FHD030 A\r\nLEFT JOIN CALL010 B ON A.HYNO=B.HYNO\r\nwhere A.HYNO in (SELECT DISTINCT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}D\')\r\n                        ', 'select B.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY B.SALONNO ORDER BY B.SALONNO, A.HYNO))) AS SEQ, A.HYNO,A.ztqf,A.phase,A.ccbh\r\nfrom FHD030 A\r\nLEFT JOIN CALL010 B ON A.HYNO=B.HYNO\r\nwhere A.HYNO in (SELECT DISTINCT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}E\')\r\n                        ', 'select SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ,hyno ,TEL\r\nfrom call010 A\r\nwhere HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}F\')\r\nORDER BY SALONNO,HYNO \r\n                        ', 'select A.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ, A.hyno ,A.TEL\r\nfrom call010 A\r\nwhere A.HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}G\')\r\nORDER BY A.SALONNO,A.HYNO\r\n                        ', 'select A.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ, A.hyno ,A.TEL\r\nfrom call010 A\r\nwhere A.HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'V25H\')\r\nORDER BY A.SALONNO,A.HYNO\r\n                        ', 'insert into FMD180EXCEL1(ccbh,HYNO)\r\nSELECT \'{$@_cwbh_@$}D\',A.HYNO\r\nfrom zkbak A \r\nleft join FHD030 B on A.HYNO =B.HYNO \r\nwhere ISNULL(b.ztqf,\'\') not in (\'\',\'1\',\'2\') ;\r\n                        ', 'insert into FMD180EXCEL1(ccbh,HYNO)\r\nSELECT \'{$@_cwbh_@$}E\',A.HYNO\r\nfrom zkbak A \r\nleft join FHD030 B on A.HYNO =B.HYNO \r\nwhere isnull(b.ztqf,\'\')+ ISNULL (b.phase,\'\') in (\'112\',\'212\')\r\n                        ', 'insert into FMD180EXCEL1(ccbh,HYNO)\r\nselect \'{$@_cwbh_@$}F\' ,hyno \r\nfrom zkbak  where HYNO+REPLACE(rtrim(ltrim(REPLACE(tel,\'-\',\'\'))),\' \',\'\') \r\nin ((select [会員№]+REPLACE(rtrim(ltrim([電話番号（ハイフンなし）])),\' \',\'\')    \r\nfrom [不備電話$]));\r\n                        ', 'insert into FMD180EXCEL1(hyno,ccbh)\r\nSELECT HYNO,\'{$@_cwbh_@$}G\' FROM(\r\nSELECT (SELECT COUNT(1) FROM [dbo].[f_split](TEL,\'-\')) AS ID,* \r\nFROM zkbak ) TT WHERE TT.ID<>3 ;\r\n                        ', 'insert into FMD180EXCEL1(hyno,ccbh)\r\nSELECT  TT.HYNO,\'V25H\' FROM \r\n(SELECT C.HYNO,CASE WHEN ISNULL(D.TEL,\'\') = \'\' THEN C.TEL ELSE D.TEL END AS TEL FROM \r\n(SELECT DIS.* FROM \r\n(SELECT  V1.HYNO AS HYNO,V1.TEL AS TEL FROM \r\n(select HYNO,TEL from zkbak) V1 ) DIS ) C\r\nLEFT JOIN(SELECT HYNO,TEL,HYM FROM FHD030) D ON C.HYNO = D.HYNO ) TT\r\nWHERE REPLACE(TT.TEL,\'-\',\'\') IN (SELECT REPLACE(AA.TEL, \'-\', \'\')\r\nFROM (SELECT CASE WHEN ISNULL(B.TEL, \'\') = \'\' THEN A.TEL ELSE B.TEL END AS TEL\r\nFROM (SELECT DISTINCT  HYNO, TEL FROM \r\n(select HYNO,TEL from zkbak) TM ) A\r\nLEFT JOIN (SELECT HYNO,TEL FROM FHD030) B ON A.HYNO = B.HYNO ) AA\r\nWHERE ISNULL(AA.TEL, \'\') <> \'\'\r\nGROUP BY REPLACE(AA.TEL, \'-\', \'\')\r\nHAVING COUNT(AA.TEL) > 1)  \r\n                        ', 'D,E,F,G,H', 'V25', '', '0', '2016-11-04 15:47:35', '0', null);
INSERT INTO `sn_tasks` VALUES ('38', '', null, null, null, 'SELECT distinct \r\n   CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO))) AS SEQ, \r\n     A.SALONNO,A.HYNO,A.HYZB,A.HYM,A.HYMKN ,A.CHGRSLNO,ISNULL(C2.SLNMC,\'\')CHSLNMC,ISNULL(B.MC,\'\') ZS,\r\n    A.SNYR,ISNULL(D.ZJGRJE,\'\') ZJGRJE,ISNULL(D.ZJGRR,\'\') ZJGRR,isnull(c.SLNDELDT,\'\'),A.TEL,\r\n    a.QHYNO,A.QHYM,ISNULL(E.DLDLLQF,\'\') DLDLLQF ,\r\n    ISNULL(E.ZTQF,\'\') ZTQF ,ISNULL(E.PHASE,\'\') PHASE,E.CCBH,E.QHCALLRS,\r\n A.BLOCKNO,F.MC\r\nFROM  CALL010 A \r\nLEFT JOIN FMD010 A0 ON A.HYNO =A0.HYNO \r\nLEFT JOIN FMD080 B ON  A.DDFXBH=B.ID\r\nLEFT JOIN FMD070 C ON A.SALONNO=C.SLNCD\r\nLEFT JOIN FMD070 C2 ON A.CHGRSLNO =C2.SLNCD\r\nLEFT JOIN FMD060 D ON A.HYNO=D.HYNO \r\nLEFT JOIN FHD030 E ON A.HYNO=E.HYNO \r\nLEFT JOIN FMD110 F ON A.BLOCKNO = F.MCKEY AND F.GLBH = \'004\' \r\nWHERE ', '--抽出コード4639～4647の最新コール結果が「OK」と「不在」の方を抽出してしてください\r\nA.HYNO in \r\n(select  a.HYNO   from FHD010 a  \r\nleft join fhd030 b on a.hyno=b.hyno \r\nwhere a.ccbh between \'4639\' and \'4647\' and b.PHASE in (\'11\',\'13\')) \r\n                        ', '--②「除外」を除く \r\nAND ISNULL(A.HYNO,\'\') not in (select distinct HYNO from FMD200 )  \r\n--④元支店長、元サロン長、Ｂ会員、友の会会員(会員№4000000からの方）\r\nAND A.HYNO NOT IN ( SELECT DISTINCT SLNKAINO  FROM FMD070 WHERE  ISNULL(SLNDELDT,\'\')<>\'00000000\') \r\nAND A.HYZB<>\'B\' AND SUBSTRING (A.HYNO,1,1) <>\'4\'    \r\n--⑤2016年4月～現在まで購入のある方（直近購入） \r\nAND isnull(D.zjgrr,\'\') < \'20160401\'  \r\n--⑥80歳以上の方（1936年12月31日までに生まれた人） \r\nAND ISNULL(a.SNYR,\'\')>\'19361231\'  \r\n--⑦【岩手県青森県コール保留地域】\r\nAND ISNULL(A.HYNO,\'\') NOT IN (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'H49H\')   \r\n--⑪【東京】サロン№8631サロン光来の会員で地位ランク愛用者の方 \r\nand ISNULL(a.HYNO,\'\') not in (select HYNO from CALL010 where SALONNO=\'008631\' and XZDW = \'10\')\r\n--⑩【中部】サロン№９３０２サロン沖田の会員の方（全員） \r\n--⑨【北陸】サロン№5271サロンドムス所属の方 \r\n--⑬【北陸】サロン№516サロン金沢所属の方 \r\n--⑭【東北】サロン№6538サロン月花美人・サロン№7432サロン珊瑚美月・サロン№9272サロン夢花月　所属の方 \r\nand a.salonno not in (\'005271\',\'009302\',\'000516\',\'006538\',\'007432\',\'009272\') \r\n--⑧【北海道】会員№で依頼した方（除外対象追加　会員№553968髙橋敬子　除外してください）\r\n--⑫【東京】会員№8821（旧サロンゆめゆめ）の傘下の会員  \r\nand ISNULL(a.HYNO,\'\') not in (select distinct hyno from FMD180EXCEL2 where ccbh in (\'0059\',\'0054\'))  \r\nand ISNULL(a.HYNO,\'\')<>\'0553968\'\r\n--⑰会員の名前で名前の前に☆がついている会員 \r\nAND SUBSTRING ( rtrim(ltrim(A.HYM)),1,1)<>\'☆\'  \r\n--⑯868班､963班～996班、1037班～1070班の方\r\nAND ISNULL(a.HYNO,\'\') not IN (select HYNO from FHD010  where  BBH in (\'0868\') \r\nOR  BBH between \'963\' and \'996\' or BBH between \'1037\' and \'1070\' ) \r\n--⑯熊本県、大分県由布市在住の方 \r\nand a.HYNO not in ( select HYNO from ZK_DONOTDELETE where qf in(\'001\',\'008\'))\r\n                        ', 'DELETE ZKBAK ;\r\n                        ', 'INSERT INTO ZKBAK(BBH,HYNO,TEL,CCBH)\r\nSELECT    distinct \'zk\',a.HYNO AS HYNO,A.TEL AS TEL,a.blockno\r\nFROM CALL010 a \r\nLEFT JOIN FMD060 D ON A.HYNO=D.HYNO \r\nLEFT JOIN FMD070 c ON A.SALONNO =c.SLNCD \r\nleft join FHD030 E on a.HYNO=E.HYNO \r\nLEFT JOIN FMD010 A0 ON A.HYNO =A0.HYNO \r\nWHERE \r\n--查询范围\r\n--除外条件\r\n                        ', 'select B.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY B.SALONNO ORDER BY B.SALONNO, A.HYNO))) AS SEQ, A.HYNO,A.ztqf,A.phase,A.ccbh\r\nfrom FHD030 A\r\nLEFT JOIN CALL010 B ON A.HYNO=B.HYNO\r\nwhere A.HYNO in (SELECT DISTINCT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}D\')\r\n                        ', 'select B.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY B.SALONNO ORDER BY B.SALONNO, A.HYNO))) AS SEQ, A.HYNO,A.ztqf,A.phase,A.ccbh\r\nfrom FHD030 A\r\nLEFT JOIN CALL010 B ON A.HYNO=B.HYNO\r\nwhere A.HYNO in (SELECT DISTINCT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}E\')\r\n                        ', 'select SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ,hyno ,TEL\r\nfrom call010 A\r\nwhere HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}F\')\r\nORDER BY SALONNO,HYNO \r\n                        ', 'select A.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ, A.hyno ,A.TEL\r\nfrom call010 A\r\nwhere A.HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}G\')\r\nORDER BY A.SALONNO,A.HYNO\r\n                        ', 'select A.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ, A.hyno ,A.TEL\r\nfrom call010 A\r\nwhere A.HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'V25H\')\r\nORDER BY A.SALONNO,A.HYNO\r\n                        ', 'insert into FMD180EXCEL1(ccbh,HYNO)\r\nSELECT \'{$@_cwbh_@$}D\',A.HYNO\r\nfrom zkbak A \r\nleft join FHD030 B on A.HYNO =B.HYNO \r\nwhere ISNULL(b.ztqf,\'\') not in (\'\',\'1\',\'2\') ;\r\n                        ', 'insert into FMD180EXCEL1(ccbh,HYNO)\r\nSELECT \'{$@_cwbh_@$}E\',A.HYNO\r\nfrom zkbak A \r\nleft join FHD030 B on A.HYNO =B.HYNO \r\nwhere isnull(b.ztqf,\'\')+ ISNULL (b.phase,\'\') in (\'112\',\'212\')\r\n                        ', 'insert into FMD180EXCEL1(ccbh,HYNO)\r\nselect \'{$@_cwbh_@$}F\' ,hyno \r\nfrom zkbak  where HYNO+REPLACE(rtrim(ltrim(REPLACE(tel,\'-\',\'\'))),\' \',\'\') \r\nin ((select [会員№]+REPLACE(rtrim(ltrim([電話番号（ハイフンなし）])),\' \',\'\')    \r\nfrom [不備電話$]));\r\n                        ', 'insert into FMD180EXCEL1(hyno,ccbh)\r\nSELECT HYNO,\'{$@_cwbh_@$}G\' FROM(\r\nSELECT (SELECT COUNT(1) FROM [dbo].[f_split](TEL,\'-\')) AS ID,* \r\nFROM zkbak ) TT WHERE TT.ID<>3 ;\r\n                        ', 'insert into FMD180EXCEL1(hyno,ccbh)\r\nSELECT  TT.HYNO,\'V25H\' FROM \r\n(SELECT C.HYNO,CASE WHEN ISNULL(D.TEL,\'\') = \'\' THEN C.TEL ELSE D.TEL END AS TEL FROM \r\n(SELECT DIS.* FROM \r\n(SELECT  V1.HYNO AS HYNO,V1.TEL AS TEL FROM \r\n(select HYNO,TEL from zkbak) V1 ) DIS ) C\r\nLEFT JOIN(SELECT HYNO,TEL,HYM FROM FHD030) D ON C.HYNO = D.HYNO ) TT\r\nWHERE REPLACE(TT.TEL,\'-\',\'\') IN (SELECT REPLACE(AA.TEL, \'-\', \'\')\r\nFROM (SELECT CASE WHEN ISNULL(B.TEL, \'\') = \'\' THEN A.TEL ELSE B.TEL END AS TEL\r\nFROM (SELECT DISTINCT  HYNO, TEL FROM \r\n(select HYNO,TEL from zkbak) TM ) A\r\nLEFT JOIN (SELECT HYNO,TEL FROM FHD030) B ON A.HYNO = B.HYNO ) AA\r\nWHERE ISNULL(AA.TEL, \'\') <> \'\'\r\nGROUP BY REPLACE(AA.TEL, \'-\', \'\')\r\nHAVING COUNT(AA.TEL) > 1)  \r\n                        ', 'D,E,F,G,H', 'V25', '', '0', '2016-11-04 15:55:46', '0', null);
INSERT INTO `sn_tasks` VALUES ('39', '', null, null, null, 'SELECT distinct \r\n   CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO))) AS SEQ, \r\n     A.SALONNO,A.HYNO,A.HYZB,A.HYM,A.HYMKN ,A.CHGRSLNO,ISNULL(C2.SLNMC,\'\')CHSLNMC,ISNULL(B.MC,\'\') ZS,\r\n    A.SNYR,ISNULL(D.ZJGRJE,\'\') ZJGRJE,ISNULL(D.ZJGRR,\'\') ZJGRR,isnull(c.SLNDELDT,\'\'),A.TEL,\r\n    a.QHYNO,A.QHYM,ISNULL(E.DLDLLQF,\'\') DLDLLQF ,\r\n    ISNULL(E.ZTQF,\'\') ZTQF ,ISNULL(E.PHASE,\'\') PHASE,E.CCBH,E.QHCALLRS,\r\n A.BLOCKNO,F.MC\r\nFROM  CALL010 A \r\nLEFT JOIN FMD010 A0 ON A.HYNO =A0.HYNO \r\nLEFT JOIN FMD080 B ON  A.DDFXBH=B.ID\r\nLEFT JOIN FMD070 C ON A.SALONNO=C.SLNCD\r\nLEFT JOIN FMD070 C2 ON A.CHGRSLNO =C2.SLNCD\r\nLEFT JOIN FMD060 D ON A.HYNO=D.HYNO \r\nLEFT JOIN FHD030 E ON A.HYNO=E.HYNO \r\nLEFT JOIN FMD110 F ON A.BLOCKNO = F.MCKEY AND F.GLBH = \'004\' \r\nWHERE ', '--抽出コード4639～4647の最新コール結果が「OK」と「不在」の方を抽出してしてください\r\nA.HYNO in \r\n(select  a.HYNO   from FHD010 a  \r\nleft join fhd030 b on a.hyno=b.hyno \r\nwhere a.ccbh between \'4639\' and \'4647\' and b.PHASE in (\'11\',\'13\')) \r\n                        ', '--②「除外」を除く \r\nAND ISNULL(A.HYNO,\'\') not in (select distinct HYNO from FMD200 )  \r\n--④元支店長、元サロン長、Ｂ会員、友の会会員(会員№4000000からの方）\r\nAND A.HYNO NOT IN ( SELECT DISTINCT SLNKAINO  FROM FMD070 WHERE  ISNULL(SLNDELDT,\'\')<>\'00000000\') \r\nAND A.HYZB<>\'B\' AND SUBSTRING (A.HYNO,1,1) <>\'4\'    \r\n--⑤2016年4月～現在まで購入のある方（直近購入） \r\nAND isnull(D.zjgrr,\'\') < \'20160401\'  \r\n--⑥80歳以上の方（1936年12月31日までに生まれた人） \r\nAND ISNULL(a.SNYR,\'\')>\'19361231\'  \r\n--⑦【岩手県青森県コール保留地域】\r\nAND ISNULL(A.HYNO,\'\') NOT IN (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'H49H\')   \r\n--⑪【東京】サロン№8631サロン光来の会員で地位ランク愛用者の方 \r\nand ISNULL(a.HYNO,\'\') not in (select HYNO from CALL010 where SALONNO=\'008631\' and XZDW = \'10\')\r\n--⑩【中部】サロン№９３０２サロン沖田の会員の方（全員） \r\n--⑨【北陸】サロン№5271サロンドムス所属の方 \r\n--⑬【北陸】サロン№516サロン金沢所属の方 \r\n--⑭【東北】サロン№6538サロン月花美人・サロン№7432サロン珊瑚美月・サロン№9272サロン夢花月　所属の方 \r\nand a.salonno not in (\'005271\',\'009302\',\'000516\',\'006538\',\'007432\',\'009272\') \r\n--⑧【北海道】会員№で依頼した方（除外対象追加　会員№553968髙橋敬子　除外してください）\r\n--⑫【東京】会員№8821（旧サロンゆめゆめ）の傘下の会員  \r\nand ISNULL(a.HYNO,\'\') not in (select distinct hyno from FMD180EXCEL2 where ccbh in (\'0059\',\'0054\'))  \r\nand ISNULL(a.HYNO,\'\')<>\'0553968\'\r\n--⑰会員の名前で名前の前に☆がついている会員 \r\nAND SUBSTRING ( rtrim(ltrim(A.HYM)),1,1)<>\'☆\'  \r\n--⑯868班､963班～996班、1037班～1070班の方\r\nAND ISNULL(a.HYNO,\'\') not IN (select HYNO from FHD010  where  BBH in (\'0868\') \r\nOR  BBH between \'963\' and \'996\' or BBH between \'1037\' and \'1070\' ) \r\n--⑯熊本県、大分県由布市在住の方 \r\nand a.HYNO not in ( select HYNO from ZK_DONOTDELETE where qf in(\'001\',\'008\'))\r\n                        ', 'DELETE ZKBAK ;\r\n                        ', 'INSERT INTO ZKBAK(BBH,HYNO,TEL,CCBH)\r\nSELECT    distinct \'zk\',a.HYNO AS HYNO,A.TEL AS TEL,a.blockno\r\nFROM CALL010 a \r\nLEFT JOIN FMD060 D ON A.HYNO=D.HYNO \r\nLEFT JOIN FMD070 c ON A.SALONNO =c.SLNCD \r\nleft join FHD030 E on a.HYNO=E.HYNO \r\nLEFT JOIN FMD010 A0 ON A.HYNO =A0.HYNO \r\nWHERE \r\n--查询范围\r\n--除外条件\r\n                        ', 'select B.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY B.SALONNO ORDER BY B.SALONNO, A.HYNO))) AS SEQ, A.HYNO,A.ztqf,A.phase,A.ccbh\r\nfrom FHD030 A\r\nLEFT JOIN CALL010 B ON A.HYNO=B.HYNO\r\nwhere A.HYNO in (SELECT DISTINCT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}D\')\r\n                        ', 'select B.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY B.SALONNO ORDER BY B.SALONNO, A.HYNO))) AS SEQ, A.HYNO,A.ztqf,A.phase,A.ccbh\r\nfrom FHD030 A\r\nLEFT JOIN CALL010 B ON A.HYNO=B.HYNO\r\nwhere A.HYNO in (SELECT DISTINCT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}E\')\r\n                        ', 'select SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ,hyno ,TEL\r\nfrom call010 A\r\nwhere HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}F\')\r\nORDER BY SALONNO,HYNO \r\n                        ', 'select A.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ, A.hyno ,A.TEL\r\nfrom call010 A\r\nwhere A.HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}G\')\r\nORDER BY A.SALONNO,A.HYNO\r\n                        ', 'select A.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ, A.hyno ,A.TEL\r\nfrom call010 A\r\nwhere A.HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'V25H\')\r\nORDER BY A.SALONNO,A.HYNO\r\n                        ', 'insert into FMD180EXCEL1(ccbh,HYNO)\r\nSELECT \'{$@_cwbh_@$}D\',A.HYNO\r\nfrom zkbak A \r\nleft join FHD030 B on A.HYNO =B.HYNO \r\nwhere ISNULL(b.ztqf,\'\') not in (\'\',\'1\',\'2\') ;\r\n                        ', 'insert into FMD180EXCEL1(ccbh,HYNO)\r\nSELECT \'{$@_cwbh_@$}E\',A.HYNO\r\nfrom zkbak A \r\nleft join FHD030 B on A.HYNO =B.HYNO \r\nwhere isnull(b.ztqf,\'\')+ ISNULL (b.phase,\'\') in (\'112\',\'212\')\r\n                        ', 'insert into FMD180EXCEL1(ccbh,HYNO)\r\nselect \'{$@_cwbh_@$}F\' ,hyno \r\nfrom zkbak  where HYNO+REPLACE(rtrim(ltrim(REPLACE(tel,\'-\',\'\'))),\' \',\'\') \r\nin ((select [会員№]+REPLACE(rtrim(ltrim([電話番号（ハイフンなし）])),\' \',\'\')    \r\nfrom [不備電話$]));\r\n                        ', 'insert into FMD180EXCEL1(hyno,ccbh)\r\nSELECT HYNO,\'{$@_cwbh_@$}G\' FROM(\r\nSELECT (SELECT COUNT(1) FROM [dbo].[f_split](TEL,\'-\')) AS ID,* \r\nFROM zkbak ) TT WHERE TT.ID<>3 ;\r\n                        ', 'insert into FMD180EXCEL1(hyno,ccbh)\r\nSELECT  TT.HYNO,\'V25H\' FROM \r\n(SELECT C.HYNO,CASE WHEN ISNULL(D.TEL,\'\') = \'\' THEN C.TEL ELSE D.TEL END AS TEL FROM \r\n(SELECT DIS.* FROM \r\n(SELECT  V1.HYNO AS HYNO,V1.TEL AS TEL FROM \r\n(select HYNO,TEL from zkbak) V1 ) DIS ) C\r\nLEFT JOIN(SELECT HYNO,TEL,HYM FROM FHD030) D ON C.HYNO = D.HYNO ) TT\r\nWHERE REPLACE(TT.TEL,\'-\',\'\') IN (SELECT REPLACE(AA.TEL, \'-\', \'\')\r\nFROM (SELECT CASE WHEN ISNULL(B.TEL, \'\') = \'\' THEN A.TEL ELSE B.TEL END AS TEL\r\nFROM (SELECT DISTINCT  HYNO, TEL FROM \r\n(select HYNO,TEL from zkbak) TM ) A\r\nLEFT JOIN (SELECT HYNO,TEL FROM FHD030) B ON A.HYNO = B.HYNO ) AA\r\nWHERE ISNULL(AA.TEL, \'\') <> \'\'\r\nGROUP BY REPLACE(AA.TEL, \'-\', \'\')\r\nHAVING COUNT(AA.TEL) > 1)  \r\n                        ', 'D,E,F,G,H', 'V99', '', '0', '2016-11-04 16:17:14', '0', null);
INSERT INTO `sn_tasks` VALUES ('40', 'test', '1112', '抽出コード4639～4647の最新コール結果が「OK」と「不在」の方を抽出してしてください', '②「除外」を除く\r④元支店長、元サロン長、Ｂ会員、友の会会員(会員№4000000からの方）\r⑤2016年4月～現在まで購入のある方（直近購入）\r⑥80歳以上の方（1936年12月31日までに生まれた人）\r⑦【岩手県青森県コール保留地域】\r⑪【東京】サロン№8631サロン光来の会員で地位ランク愛用者の方\r⑩【中部】サロン№９３０２サロン沖田の会員の方（全員）\r⑨【北陸】サロン№5271サロンドムス所属の方\r⑬【北陸】サロン№516サロン金沢所属の方\r⑭【東北】サロン№6538サロン月花美人・サロン№7432サロン珊瑚美月・サロン№9272サロン夢花月　所属の方\r⑧【北海道】会員№で依頼した方（除外対象追加　会員№553968髙橋敬子　除外してください）\r⑫【東京】会員№8821（旧サロンゆめゆめ）の傘下の会員\r⑰会員の名前で名前の前に☆がついている会員\r⑯868班､963班～996班、1037班～1070班の方\r⑯熊本県、大分県由布市在住の方', 'SELECT distinct \r\n   CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO))) AS SEQ, \r\n     A.SALONNO,A.HYNO,A.HYZB,A.HYM,A.HYMKN ,A.CHGRSLNO,ISNULL(C2.SLNMC,\'\')CHSLNMC,ISNULL(B.MC,\'\') ZS,\r\n    A.SNYR,ISNULL(D.ZJGRJE,\'\') ZJGRJE,ISNULL(D.ZJGRR,\'\') ZJGRR,isnull(c.SLNDELDT,\'\'),A.TEL,\r\n    a.QHYNO,A.QHYM,ISNULL(E.DLDLLQF,\'\') DLDLLQF ,\r\n    ISNULL(E.ZTQF,\'\') ZTQF ,ISNULL(E.PHASE,\'\') PHASE,E.CCBH,E.QHCALLRS,\r\n A.BLOCKNO,F.MC\r\nFROM  CALL010 A \r\nLEFT JOIN FMD010 A0 ON A.HYNO =A0.HYNO \r\nLEFT JOIN FMD080 B ON  A.DDFXBH=B.ID\r\nLEFT JOIN FMD070 C ON A.SALONNO=C.SLNCD\r\nLEFT JOIN FMD070 C2 ON A.CHGRSLNO =C2.SLNCD\r\nLEFT JOIN FMD060 D ON A.HYNO=D.HYNO \r\nLEFT JOIN FHD030 E ON A.HYNO=E.HYNO \r\nLEFT JOIN FMD110 F ON A.BLOCKNO = F.MCKEY AND F.GLBH = \'004\' \r\nWHERE ', '--抽出コード4639～4647の最新コール結果が「OK」と「不在」の方を抽出してしてください\r\nA.HYNO in \r\n(select  a.HYNO   from FHD010 a  \r\nleft join fhd030 b on a.hyno=b.hyno \r\nwhere a.ccbh between \'4639\' and \'4647\' and b.PHASE in (\'11\',\'13\')) \r\n                        ', '--②「除外」を除く \r\nAND ISNULL(A.HYNO,\'\') not in (select distinct HYNO from FMD200 )  \r\n--④元支店長、元サロン長、Ｂ会員、友の会会員(会員№4000000からの方）\r\nAND A.HYNO NOT IN ( SELECT DISTINCT SLNKAINO  FROM FMD070 WHERE  ISNULL(SLNDELDT,\'\')<>\'00000000\') \r\nAND A.HYZB<>\'B\' AND SUBSTRING (A.HYNO,1,1) <>\'4\'    \r\n--⑤2016年4月～現在まで購入のある方（直近購入） \r\nAND isnull(D.zjgrr,\'\') < \'20160401\'  \r\n--⑥80歳以上の方（1936年12月31日までに生まれた人） \r\nAND ISNULL(a.SNYR,\'\')>\'19361231\'  \r\n--⑦【岩手県青森県コール保留地域】\r\nAND ISNULL(A.HYNO,\'\') NOT IN (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'H49H\')   \r\n--⑪【東京】サロン№8631サロン光来の会員で地位ランク愛用者の方 \r\nand ISNULL(a.HYNO,\'\') not in (select HYNO from CALL010 where SALONNO=\'008631\' and XZDW = \'10\')\r\n--⑩【中部】サロン№９３０２サロン沖田の会員の方（全員） \r\n--⑨【北陸】サロン№5271サロンドムス所属の方 \r\n--⑬【北陸】サロン№516サロン金沢所属の方 \r\n--⑭【東北】サロン№6538サロン月花美人・サロン№7432サロン珊瑚美月・サロン№9272サロン夢花月　所属の方 \r\nand a.salonno not in (\'005271\',\'009302\',\'000516\',\'006538\',\'007432\',\'009272\') \r\n--⑧【北海道】会員№で依頼した方（除外対象追加　会員№553968髙橋敬子　除外してください）\r\n--⑫【東京】会員№8821（旧サロンゆめゆめ）の傘下の会員  \r\nand ISNULL(a.HYNO,\'\') not in (select distinct hyno from FMD180EXCEL2 where ccbh in (\'0059\',\'0054\'))  \r\nand ISNULL(a.HYNO,\'\')<>\'0553968\'\r\n--⑰会員の名前で名前の前に☆がついている会員 \r\nAND SUBSTRING ( rtrim(ltrim(A.HYM)),1,1)<>\'☆\'  \r\n--⑯868班､963班～996班、1037班～1070班の方\r\nAND ISNULL(a.HYNO,\'\') not IN (select HYNO from FHD010  where  BBH in (\'0868\') \r\nOR  BBH between \'963\' and \'996\' or BBH between \'1037\' and \'1070\' ) \r\n--⑯熊本県、大分県由布市在住の方 \r\nand a.HYNO not in ( select HYNO from ZK_DONOTDELETE where qf in(\'001\',\'008\'))\r\n                        ', 'DELETE ZKBAK ;\r\n                        ', 'INSERT INTO ZKBAK(BBH,HYNO,TEL,CCBH)\r\nSELECT    distinct \'zk\',a.HYNO AS HYNO,A.TEL AS TEL,a.blockno\r\nFROM CALL010 a \r\nLEFT JOIN FMD060 D ON A.HYNO=D.HYNO \r\nLEFT JOIN FMD070 c ON A.SALONNO =c.SLNCD \r\nleft join FHD030 E on a.HYNO=E.HYNO \r\nLEFT JOIN FMD010 A0 ON A.HYNO =A0.HYNO \r\nWHERE \r\n--查询范围\r\n--除外条件\r\n                        ', 'select B.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY B.SALONNO ORDER BY B.SALONNO, A.HYNO))) AS SEQ, A.HYNO,A.ztqf,A.phase,A.ccbh\r\nfrom FHD030 A\r\nLEFT JOIN CALL010 B ON A.HYNO=B.HYNO\r\nwhere A.HYNO in (SELECT DISTINCT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}D\')\r\n                        ', 'select B.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY B.SALONNO ORDER BY B.SALONNO, A.HYNO))) AS SEQ, A.HYNO,A.ztqf,A.phase,A.ccbh\r\nfrom FHD030 A\r\nLEFT JOIN CALL010 B ON A.HYNO=B.HYNO\r\nwhere A.HYNO in (SELECT DISTINCT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}E\')\r\n                        ', 'select SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ,hyno ,TEL\r\nfrom call010 A\r\nwhere HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}F\')\r\nORDER BY SALONNO,HYNO \r\n                        ', 'select A.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ, A.hyno ,A.TEL\r\nfrom call010 A\r\nwhere A.HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'{$@_cwbh_@$}G\')\r\nORDER BY A.SALONNO,A.HYNO\r\n                        ', 'select A.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ, A.hyno ,A.TEL\r\nfrom call010 A\r\nwhere A.HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'V25H\')\r\nORDER BY A.SALONNO,A.HYNO\r\n                        ', 'insert into FMD180EXCEL1(ccbh,HYNO)\r\nSELECT \'{$@_cwbh_@$}D\',A.HYNO\r\nfrom zkbak A \r\nleft join FHD030 B on A.HYNO =B.HYNO \r\nwhere ISNULL(b.ztqf,\'\') not in (\'\',\'1\',\'2\') ;\r\n                        ', 'insert into FMD180EXCEL1(ccbh,HYNO)\r\nSELECT \'{$@_cwbh_@$}E\',A.HYNO\r\nfrom zkbak A \r\nleft join FHD030 B on A.HYNO =B.HYNO \r\nwhere isnull(b.ztqf,\'\')+ ISNULL (b.phase,\'\') in (\'112\',\'212\')\r\n                        ', 'insert into FMD180EXCEL1(ccbh,HYNO)\r\nselect \'{$@_cwbh_@$}F\' ,hyno \r\nfrom zkbak  where HYNO+REPLACE(rtrim(ltrim(REPLACE(tel,\'-\',\'\'))),\' \',\'\') \r\nin ((select [会員№]+REPLACE(rtrim(ltrim([電話番号（ハイフンなし）])),\' \',\'\')    \r\nfrom [不備電話$]));\r\n                        ', 'insert into FMD180EXCEL1(hyno,ccbh)\r\nSELECT HYNO,\'{$@_cwbh_@$}G\' FROM(\r\nSELECT (SELECT COUNT(1) FROM [dbo].[f_split](TEL,\'-\')) AS ID,* \r\nFROM zkbak ) TT WHERE TT.ID<>3 ;\r\n                        ', 'insert into FMD180EXCEL1(hyno,ccbh)\r\nSELECT  TT.HYNO,\'V25H\' FROM \r\n(SELECT C.HYNO,CASE WHEN ISNULL(D.TEL,\'\') = \'\' THEN C.TEL ELSE D.TEL END AS TEL FROM \r\n(SELECT DIS.* FROM \r\n(SELECT  V1.HYNO AS HYNO,V1.TEL AS TEL FROM \r\n(select HYNO,TEL from zkbak) V1 ) DIS ) C\r\nLEFT JOIN(SELECT HYNO,TEL,HYM FROM FHD030) D ON C.HYNO = D.HYNO ) TT\r\nWHERE REPLACE(TT.TEL,\'-\',\'\') IN (SELECT REPLACE(AA.TEL, \'-\', \'\')\r\nFROM (SELECT CASE WHEN ISNULL(B.TEL, \'\') = \'\' THEN A.TEL ELSE B.TEL END AS TEL\r\nFROM (SELECT DISTINCT  HYNO, TEL FROM \r\n(select HYNO,TEL from zkbak) TM ) A\r\nLEFT JOIN (SELECT HYNO,TEL FROM FHD030) B ON A.HYNO = B.HYNO ) AA\r\nWHERE ISNULL(AA.TEL, \'\') <> \'\'\r\nGROUP BY REPLACE(AA.TEL, \'-\', \'\')\r\nHAVING COUNT(AA.TEL) > 1)  \r\n                        ', 'D,E,F,G,H', 'V99', '', '0', '2016-11-11 15:19:39', '3', null);

-- ----------------------------
-- Table structure for sn_task_detail
-- ----------------------------
DROP TABLE IF EXISTS `sn_task_detail`;
CREATE TABLE `sn_task_detail` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `relate_id` int(11) NOT NULL,
  `name` varchar(12) NOT NULL,
  `sql_content` text NOT NULL COMMENT 'SQL内容',
  `num_rows` int(11) DEFAULT NULL COMMENT '执行结果件数',
  `status` varchar(1) DEFAULT NULL COMMENT 'SQL执行结果 0：失败 ，1：成功',
  `create_time` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=57 DEFAULT CHARSET=utf8;

-- ----------------------------
-- Records of sn_task_detail
-- ----------------------------
INSERT INTO `sn_task_detail` VALUES ('19', '35', 'A', 'select top 10 * from call010', '10', '1', '2016-11-09 13:05:38');
INSERT INTO `sn_task_detail` VALUES ('20', '35', 'B', 'SELECT distinct \r\n   CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO))) AS SEQ, \r\n     A.SALONNO,A.HYNO,A.HYZB,A.HYM,A.HYMKN ,A.CHGRSLNO,ISNULL(C2.SLNMC,\'\')CHSLNMC,ISNULL(B.MC,\'\') ZS,\r\n    A.SNYR,ISNULL(D.ZJGRJE,\'\') ZJGRJE,ISNULL(D.ZJGRR,\'\') ZJGRR,isnull(c.SLNDELDT,\'\'),A.TEL,\r\n    a.QHYNO,A.QHYM,ISNULL(E.DLDLLQF,\'\') DLDLLQF ,\r\n    ISNULL(E.ZTQF,\'\') ZTQF ,ISNULL(E.PHASE,\'\') PHASE,E.CCBH,E.QHCALLRS,\r\n A.BLOCKNO,F.MC\r\nFROM  CALL010 A \r\nLEFT JOIN FMD010 A0 ON A.HYNO =A0.HYNO \r\nLEFT JOIN FMD080 B ON  A.DDFXBH=B.ID\r\nLEFT JOIN FMD070 C ON A.SALONNO=C.SLNCD\r\nLEFT JOIN FMD070 C2 ON A.CHGRSLNO =C2.SLNCD\r\nLEFT JOIN FMD060 D ON A.HYNO=D.HYNO \r\nLEFT JOIN FHD030 E ON A.HYNO=E.HYNO \r\nLEFT JOIN FMD110 F ON A.BLOCKNO = F.MCKEY AND F.GLBH = \'004\' \r\nWHERE --抽出コード4639～4647の最新コール結果が「OK」と「不在」の方を抽出してしてください\r\nA.HYNO in \r\n(select  a.HYNO   from FHD010 a  \r\nleft join fhd030 b on a.hyno=b.hyno \r\nwhere a.ccbh between \'4639\' and \'4647\' and b.PHASE in (\'11\',\'13\')) \r\n                        --②「除外」を除く \r\nAND ISNULL(A.HYNO,\'\') not in (select distinct HYNO from FMD200 )  \r\n--④元支店長、元サロン長、Ｂ会員、友の会会員(会員№4000000からの方）\r\nAND A.HYNO NOT IN ( SELECT DISTINCT SLNKAINO  FROM FMD070 WHERE  ISNULL(SLNDELDT,\'\')<>\'00000000\') \r\nAND A.HYZB<>\'B\' AND SUBSTRING (A.HYNO,1,1) <>\'4\'    \r\n--⑤2016年4月～現在まで購入のある方（直近購入） \r\nAND isnull(D.zjgrr,\'\') < \'20160401\'  \r\n--⑥80歳以上の方（1936年12月31日までに生まれた人） \r\nAND ISNULL(a.SNYR,\'\')>\'19361231\'  \r\n--⑦【岩手県青森県コール保留地域】\r\nAND ISNULL(A.HYNO,\'\') NOT IN (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'H49H\')   \r\n--⑪【東京】サロン№8631サロン光来の会員で地位ランク愛用者の方 \r\nand ISNULL(a.HYNO,\'\') not in (select HYNO from CALL010 where SALONNO=\'008631\' and XZDW = \'10\')\r\n--⑩【中部】サロン№９３０２サロン沖田の会員の方（全員） \r\n--⑨【北陸】サロン№5271サロンドムス所属の方 \r\n--⑬【北陸】サロン№516サロン金沢所属の方 \r\n--⑭【東北】サロン№6538サロン月花美人・サロン№7432サロン珊瑚美月・サロン№9272サロン夢花月　所属の方 \r\nand a.salonno not in (\'005271\',\'009302\',\'000516\',\'006538\',\'007432\',\'009272\') \r\n--⑧【北海道】会員№で依頼した方（除外対象追加　会員№553968髙橋敬子　除外してください）\r\n--⑫【東京】会員№8821（旧サロンゆめゆめ）の傘下の会員  \r\nand ISNULL(a.HYNO,\'\') not in (select distinct hyno from FMD180EXCEL2 where ccbh in (\'0059\',\'0054\'))  \r\nand ISNULL(a.HYNO,\'\')<>\'0553968\'\r\n--⑰会員の名前で名前の前に☆がついている会員 \r\nAND SUBSTRING ( rtrim(ltrim(A.HYM)),1,1)<>\'☆\'  \r\n--⑯868班､963班～996班、1037班～1070班の方\r\nAND ISNULL(a.HYNO,\'\') not IN (select HYNO from FHD010  where  BBH in (\'0868\') \r\nOR  BBH between \'963\' and \'996\' or BBH between \'1037\' and \'1070\' ) \r\n--⑯熊本県、大分県由布市在住の方 \r\nand a.HYNO not in ( select HYNO from ZK_DONOTDELETE where qf in(\'001\',\'008\'))\r\n                        ', null, '0', null);
INSERT INTO `sn_task_detail` VALUES ('21', '38', 'A', 'SELECT distinct \r\n   CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO))) AS SEQ, \r\n     A.SALONNO,A.HYNO,A.HYZB,A.HYM,A.HYMKN ,A.CHGRSLNO,ISNULL(C2.SLNMC,\'\')CHSLNMC,ISNULL(B.MC,\'\') ZS,\r\n    A.SNYR,ISNULL(D.ZJGRJE,\'\') ZJGRJE,ISNULL(D.ZJGRR,\'\') ZJGRR,isnull(c.SLNDELDT,\'\'),A.TEL,\r\n    a.QHYNO,A.QHYM,ISNULL(E.DLDLLQF,\'\') DLDLLQF ,\r\n    ISNULL(E.ZTQF,\'\') ZTQF ,ISNULL(E.PHASE,\'\') PHASE,E.CCBH,E.QHCALLRS,\r\n A.BLOCKNO,F.MC\r\nFROM  CALL010 A \r\nLEFT JOIN FMD010 A0 ON A.HYNO =A0.HYNO \r\nLEFT JOIN FMD080 B ON  A.DDFXBH=B.ID\r\nLEFT JOIN FMD070 C ON A.SALONNO=C.SLNCD\r\nLEFT JOIN FMD070 C2 ON A.CHGRSLNO =C2.SLNCD\r\nLEFT JOIN FMD060 D ON A.HYNO=D.HYNO \r\nLEFT JOIN FHD030 E ON A.HYNO=E.HYNO \r\nLEFT JOIN FMD110 F ON A.BLOCKNO = F.MCKEY AND F.GLBH = \'004\' \r\nWHERE --抽出コード4639～4647の最新コール結果が「OK」と「不在」の方を抽出してしてください\r\nA.HYNO in \r\n(select  a.HYNO   from FHD010 a  \r\nleft join fhd030 b on a.hyno=b.hyno \r\nwhere a.ccbh between \'4639\' and \'4647\' and b.PHASE in (\'11\',\'13\')) \r\n                        ', null, '0', null);
INSERT INTO `sn_task_detail` VALUES ('22', '38', 'B', 'SELECT distinct \r\n   CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO))) AS SEQ, \r\n     A.SALONNO,A.HYNO,A.HYZB,A.HYM,A.HYMKN ,A.CHGRSLNO,ISNULL(C2.SLNMC,\'\')CHSLNMC,ISNULL(B.MC,\'\') ZS,\r\n    A.SNYR,ISNULL(D.ZJGRJE,\'\') ZJGRJE,ISNULL(D.ZJGRR,\'\') ZJGRR,isnull(c.SLNDELDT,\'\'),A.TEL,\r\n    a.QHYNO,A.QHYM,ISNULL(E.DLDLLQF,\'\') DLDLLQF ,\r\n    ISNULL(E.ZTQF,\'\') ZTQF ,ISNULL(E.PHASE,\'\') PHASE,E.CCBH,E.QHCALLRS,\r\n A.BLOCKNO,F.MC\r\nFROM  CALL010 A \r\nLEFT JOIN FMD010 A0 ON A.HYNO =A0.HYNO \r\nLEFT JOIN FMD080 B ON  A.DDFXBH=B.ID\r\nLEFT JOIN FMD070 C ON A.SALONNO=C.SLNCD\r\nLEFT JOIN FMD070 C2 ON A.CHGRSLNO =C2.SLNCD\r\nLEFT JOIN FMD060 D ON A.HYNO=D.HYNO \r\nLEFT JOIN FHD030 E ON A.HYNO=E.HYNO \r\nLEFT JOIN FMD110 F ON A.BLOCKNO = F.MCKEY AND F.GLBH = \'004\' \r\nWHERE --抽出コード4639～4647の最新コール結果が「OK」と「不在」の方を抽出してしてください\r\nA.HYNO in \r\n(select  a.HYNO   from FHD010 a  \r\nleft join fhd030 b on a.hyno=b.hyno \r\nwhere a.ccbh between \'4639\' and \'4647\' and b.PHASE in (\'11\',\'13\')) \r\n                        --②「除外」を除く \r\nAND ISNULL(A.HYNO,\'\') not in (select distinct HYNO from FMD200 )  \r\n--④元支店長、元サロン長、Ｂ会員、友の会会員(会員№4000000からの方）\r\nAND A.HYNO NOT IN ( SELECT DISTINCT SLNKAINO  FROM FMD070 WHERE  ISNULL(SLNDELDT,\'\')<>\'00000000\') \r\nAND A.HYZB<>\'B\' AND SUBSTRING (A.HYNO,1,1) <>\'4\'    \r\n--⑤2016年4月～現在まで購入のある方（直近購入） \r\nAND isnull(D.zjgrr,\'\') < \'20160401\'  \r\n--⑥80歳以上の方（1936年12月31日までに生まれた人） \r\nAND ISNULL(a.SNYR,\'\')>\'19361231\'  \r\n--⑦【岩手県青森県コール保留地域】\r\nAND ISNULL(A.HYNO,\'\') NOT IN (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'H49H\')   \r\n--⑪【東京】サロン№8631サロン光来の会員で地位ランク愛用者の方 \r\nand ISNULL(a.HYNO,\'\') not in (select HYNO from CALL010 where SALONNO=\'008631\' and XZDW = \'10\')\r\n--⑩【中部】サロン№９３０２サロン沖田の会員の方（全員） \r\n--⑨【北陸】サロン№5271サロンドムス所属の方 \r\n--⑬【北陸】サロン№516サロン金沢所属の方 \r\n--⑭【東北】サロン№6538サロン月花美人・サロン№7432サロン珊瑚美月・サロン№9272サロン夢花月　所属の方 \r\nand a.salonno not in (\'005271\',\'009302\',\'000516\',\'006538\',\'007432\',\'009272\') \r\n--⑧【北海道】会員№で依頼した方（除外対象追加　会員№553968髙橋敬子　除外してください）\r\n--⑫【東京】会員№8821（旧サロンゆめゆめ）の傘下の会員  \r\nand ISNULL(a.HYNO,\'\') not in (select distinct hyno from FMD180EXCEL2 where ccbh in (\'0059\',\'0054\'))  \r\nand ISNULL(a.HYNO,\'\')<>\'0553968\'\r\n--⑰会員の名前で名前の前に☆がついている会員 \r\nAND SUBSTRING ( rtrim(ltrim(A.HYM)),1,1)<>\'☆\'  \r\n--⑯868班､963班～996班、1037班～1070班の方\r\nAND ISNULL(a.HYNO,\'\') not IN (select HYNO from FHD010  where  BBH in (\'0868\') \r\nOR  BBH between \'963\' and \'996\' or BBH between \'1037\' and \'1070\' ) \r\n--⑯熊本県、大分県由布市在住の方 \r\nand a.HYNO not in ( select HYNO from ZK_DONOTDELETE where qf in(\'001\',\'008\'))\r\n                        ', null, '0', null);
INSERT INTO `sn_task_detail` VALUES ('23', '38', 'DEL_AB_BAK', 'DELETE ZKBAK ;\r\n                        ', null, '0', null);
INSERT INTO `sn_task_detail` VALUES ('24', '38', 'AB_BAK', 'INSERT INTO ZKBAK(BBH,HYNO,TEL,CCBH)\r\nSELECT    distinct \'zk\',a.HYNO AS HYNO,A.TEL AS TEL,a.blockno\r\nFROM CALL010 a \r\nLEFT JOIN FMD060 D ON A.HYNO=D.HYNO \r\nLEFT JOIN FMD070 c ON A.SALONNO =c.SLNCD \r\nleft join FHD030 E on a.HYNO=E.HYNO \r\nLEFT JOIN FMD010 A0 ON A.HYNO =A0.HYNO \r\nWHERE \r\n--查询范围\r\n--除外条件\r\n                        --抽出コード4639～4647の最新コール結果が「OK」と「不在」の方を抽出してしてください\r\nA.HYNO in \r\n(select  a.HYNO   from FHD010 a  \r\nleft join fhd030 b on a.hyno=b.hyno \r\nwhere a.ccbh between \'4639\' and \'4647\' and b.PHASE in (\'11\',\'13\')) \r\n                        --②「除外」を除く \r\nAND ISNULL(A.HYNO,\'\') not in (select distinct HYNO from FMD200 )  \r\n--④元支店長、元サロン長、Ｂ会員、友の会会員(会員№4000000からの方）\r\nAND A.HYNO NOT IN ( SELECT DISTINCT SLNKAINO  FROM FMD070 WHERE  ISNULL(SLNDELDT,\'\')<>\'00000000\') \r\nAND A.HYZB<>\'B\' AND SUBSTRING (A.HYNO,1,1) <>\'4\'    \r\n--⑤2016年4月～現在まで購入のある方（直近購入） \r\nAND isnull(D.zjgrr,\'\') < \'20160401\'  \r\n--⑥80歳以上の方（1936年12月31日までに生まれた人） \r\nAND ISNULL(a.SNYR,\'\')>\'19361231\'  \r\n--⑦【岩手県青森県コール保留地域】\r\nAND ISNULL(A.HYNO,\'\') NOT IN (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'H49H\')   \r\n--⑪【東京】サロン№8631サロン光来の会員で地位ランク愛用者の方 \r\nand ISNULL(a.HYNO,\'\') not in (select HYNO from CALL010 where SALONNO=\'008631\' and XZDW = \'10\')\r\n--⑩【中部】サロン№９３０２サロン沖田の会員の方（全員） \r\n--⑨【北陸】サロン№5271サロンドムス所属の方 \r\n--⑬【北陸】サロン№516サロン金沢所属の方 \r\n--⑭【東北】サロン№6538サロン月花美人・サロン№7432サロン珊瑚美月・サロン№9272サロン夢花月　所属の方 \r\nand a.salonno not in (\'005271\',\'009302\',\'000516\',\'006538\',\'007432\',\'009272\') \r\n--⑧【北海道】会員№で依頼した方（除外対象追加　会員№553968髙橋敬子　除外してください）\r\n--⑫【東京】会員№8821（旧サロンゆめゆめ）の傘下の会員  \r\nand ISNULL(a.HYNO,\'\') not in (select distinct hyno from FMD180EXCEL2 where ccbh in (\'0059\',\'0054\'))  \r\nand ISNULL(a.HYNO,\'\')<>\'0553968\'\r\n--⑰会員の名前で名前の前に☆がついている会員 \r\nAND SUBSTRING ( rtrim(ltrim(A.HYM)),1,1)<>\'☆\'  \r\n--⑯868班､963班～996班、1037班～1070班の方\r\nAND ISNULL(a.HYNO,\'\') not IN (select HYNO from FHD010  where  BBH in (\'0868\') \r\nOR  BBH between \'963\' and \'996\' or BBH between \'1037\' and \'1070\' ) \r\n--⑯熊本県、大分県由布市在住の方 \r\nand a.HYNO not in ( select HYNO from ZK_DONOTDELETE where qf in(\'001\',\'008\'))\r\n                        ', null, '0', null);
INSERT INTO `sn_task_detail` VALUES ('25', '38', 'InsertD', 'insert into FMD180EXCEL1(ccbh,HYNO)\r\nSELECT \'V25D\',A.HYNO\r\nfrom zkbak A \r\nleft join FHD030 B on A.HYNO =B.HYNO \r\nwhere ISNULL(b.ztqf,\'\') not in (\'\',\'1\',\'2\') ;\r\n                        ', null, '0', null);
INSERT INTO `sn_task_detail` VALUES ('26', '38', 'D', 'select B.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY B.SALONNO ORDER BY B.SALONNO, A.HYNO))) AS SEQ, A.HYNO,A.ztqf,A.phase,A.ccbh\r\nfrom FHD030 A\r\nLEFT JOIN CALL010 B ON A.HYNO=B.HYNO\r\nwhere A.HYNO in (SELECT DISTINCT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'V25D\')\r\n                        ', null, '0', null);
INSERT INTO `sn_task_detail` VALUES ('27', '38', 'InsertE', 'insert into FMD180EXCEL1(ccbh,HYNO)\r\nSELECT \'V25E\',A.HYNO\r\nfrom zkbak A \r\nleft join FHD030 B on A.HYNO =B.HYNO \r\nwhere isnull(b.ztqf,\'\')+ ISNULL (b.phase,\'\') in (\'112\',\'212\')\r\n                        ', null, '0', null);
INSERT INTO `sn_task_detail` VALUES ('28', '38', 'E', 'select B.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY B.SALONNO ORDER BY B.SALONNO, A.HYNO))) AS SEQ, A.HYNO,A.ztqf,A.phase,A.ccbh\r\nfrom FHD030 A\r\nLEFT JOIN CALL010 B ON A.HYNO=B.HYNO\r\nwhere A.HYNO in (SELECT DISTINCT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'V25E\')\r\n                        ', null, '0', null);
INSERT INTO `sn_task_detail` VALUES ('29', '38', 'InsertF', 'insert into FMD180EXCEL1(ccbh,HYNO)\r\nselect \'V25F\' ,hyno \r\nfrom zkbak  where HYNO+REPLACE(rtrim(ltrim(REPLACE(tel,\'-\',\'\'))),\' \',\'\') \r\nin ((select [会員№]+REPLACE(rtrim(ltrim([電話番号（ハイフンなし）])),\' \',\'\')    \r\nfrom [不備電話$]));\r\n                        ', null, '0', null);
INSERT INTO `sn_task_detail` VALUES ('30', '38', 'F', 'select SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ,hyno ,TEL\r\nfrom call010 A\r\nwhere HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'V25F\')\r\nORDER BY SALONNO,HYNO \r\n                        ', null, '0', null);
INSERT INTO `sn_task_detail` VALUES ('31', '38', 'InsertG', 'insert into FMD180EXCEL1(hyno,ccbh)\r\nSELECT HYNO,\'V25G\' FROM(\r\nSELECT (SELECT COUNT(1) FROM [dbo].[f_split](TEL,\'-\')) AS ID,* \r\nFROM zkbak ) TT WHERE TT.ID<>3 ;\r\n                        ', null, '0', null);
INSERT INTO `sn_task_detail` VALUES ('32', '38', 'G', 'select A.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ, A.hyno ,A.TEL\r\nfrom call010 A\r\nwhere A.HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'V25G\')\r\nORDER BY A.SALONNO,A.HYNO\r\n                        ', null, '0', null);
INSERT INTO `sn_task_detail` VALUES ('33', '38', 'InsertH', 'insert into FMD180EXCEL1(hyno,ccbh)\r\nSELECT  TT.HYNO,\'V25H\' FROM \r\n(SELECT C.HYNO,CASE WHEN ISNULL(D.TEL,\'\') = \'\' THEN C.TEL ELSE D.TEL END AS TEL FROM \r\n(SELECT DIS.* FROM \r\n(SELECT  V1.HYNO AS HYNO,V1.TEL AS TEL FROM \r\n(select HYNO,TEL from zkbak) V1 ) DIS ) C\r\nLEFT JOIN(SELECT HYNO,TEL,HYM FROM FHD030) D ON C.HYNO = D.HYNO ) TT\r\nWHERE REPLACE(TT.TEL,\'-\',\'\') IN (SELECT REPLACE(AA.TEL, \'-\', \'\')\r\nFROM (SELECT CASE WHEN ISNULL(B.TEL, \'\') = \'\' THEN A.TEL ELSE B.TEL END AS TEL\r\nFROM (SELECT DISTINCT  HYNO, TEL FROM \r\n(select HYNO,TEL from zkbak) TM ) A\r\nLEFT JOIN (SELECT HYNO,TEL FROM FHD030) B ON A.HYNO = B.HYNO ) AA\r\nWHERE ISNULL(AA.TEL, \'\') <> \'\'\r\nGROUP BY REPLACE(AA.TEL, \'-\', \'\')\r\nHAVING COUNT(AA.TEL) > 1)  \r\n                        ', null, '0', null);
INSERT INTO `sn_task_detail` VALUES ('34', '38', 'H', 'select A.SALONNO,\r\n    CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO, A.HYNO))) AS SEQ, A.hyno ,A.TEL\r\nfrom call010 A\r\nwhere A.HYNO in (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'V25H\')\r\nORDER BY A.SALONNO,A.HYNO\r\n                        ', null, '0', null);
INSERT INTO `sn_task_detail` VALUES ('35', '38', 'AH', 'SELECT distinct \r\n   CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO))) AS SEQ, \r\n     A.SALONNO,A.HYNO,A.HYZB,A.HYM,A.HYMKN ,A.CHGRSLNO,ISNULL(C2.SLNMC,\'\')CHSLNMC,ISNULL(B.MC,\'\') ZS,\r\n    A.SNYR,ISNULL(D.ZJGRJE,\'\') ZJGRJE,ISNULL(D.ZJGRR,\'\') ZJGRR,isnull(c.SLNDELDT,\'\'),A.TEL,\r\n    a.QHYNO,A.QHYM,ISNULL(E.DLDLLQF,\'\') DLDLLQF ,\r\n    ISNULL(E.ZTQF,\'\') ZTQF ,ISNULL(E.PHASE,\'\') PHASE,E.CCBH,E.QHCALLRS,\r\n A.BLOCKNO,F.MC\r\nFROM  CALL010 A \r\nLEFT JOIN FMD010 A0 ON A.HYNO =A0.HYNO \r\nLEFT JOIN FMD080 B ON  A.DDFXBH=B.ID\r\nLEFT JOIN FMD070 C ON A.SALONNO=C.SLNCD\r\nLEFT JOIN FMD070 C2 ON A.CHGRSLNO =C2.SLNCD\r\nLEFT JOIN FMD060 D ON A.HYNO=D.HYNO \r\nLEFT JOIN FHD030 E ON A.HYNO=E.HYNO \r\nLEFT JOIN FMD110 F ON A.BLOCKNO = F.MCKEY AND F.GLBH = \'004\' \r\nWHERE \r\n--抽出コード4639～4647の最新コール結果が「OK」と「不在」の方を抽出してしてください\r\nA.HYNO in \r\n(select  a.HYNO   from FHD010 a  \r\nleft join fhd030 b on a.hyno=b.hyno \r\nwhere a.ccbh between \'4639\' and \'4647\' and b.PHASE in (\'11\',\'13\')) \r\n                        \r\n--②「除外」を除く \r\nAND ISNULL(A.HYNO,\'\') not in (select distinct HYNO from FMD200 )  \r\n--④元支店長、元サロン長、Ｂ会員、友の会会員(会員№4000000からの方）\r\nAND A.HYNO NOT IN ( SELECT DISTINCT SLNKAINO  FROM FMD070 WHERE  ISNULL(SLNDELDT,\'\')<>\'00000000\') \r\nAND A.HYZB<>\'B\' AND SUBSTRING (A.HYNO,1,1) <>\'4\'    \r\n--⑤2016年4月～現在まで購入のある方（直近購入） \r\nAND isnull(D.zjgrr,\'\') < \'20160401\'  \r\n--⑥80歳以上の方（1936年12月31日までに生まれた人） \r\nAND ISNULL(a.SNYR,\'\')>\'19361231\'  \r\n--⑦【岩手県青森県コール保留地域】\r\nAND ISNULL(A.HYNO,\'\') NOT IN (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'H49H\')   \r\n--⑪【東京】サロン№8631サロン光来の会員で地位ランク愛用者の方 \r\nand ISNULL(a.HYNO,\'\') not in (select HYNO from CALL010 where SALONNO=\'008631\' and XZDW = \'10\')\r\n--⑩【中部】サロン№９３０２サロン沖田の会員の方（全員） \r\n--⑨【北陸】サロン№5271サロンドムス所属の方 \r\n--⑬【北陸】サロン№516サロン金沢所属の方 \r\n--⑭【東北】サロン№6538サロン月花美人・サロン№7432サロン珊瑚美月・サロン№9272サロン夢花月　所属の方 \r\nand a.salonno not in (\'005271\',\'009302\',\'000516\',\'006538\',\'007432\',\'009272\') \r\n--⑧【北海道】会員№で依頼した方（除外対象追加　会員№553968髙橋敬子　除外してください）\r\n--⑫【東京】会員№8821（旧サロンゆめゆめ）の傘下の会員  \r\nand ISNULL(a.HYNO,\'\') not in (select distinct hyno from FMD180EXCEL2 where ccbh in (\'0059\',\'0054\'))  \r\nand ISNULL(a.HYNO,\'\')<>\'0553968\'\r\n--⑰会員の名前で名前の前に☆がついている会員 \r\nAND SUBSTRING ( rtrim(ltrim(A.HYM)),1,1)<>\'☆\'  \r\n--⑯868班､963班～996班、1037班～1070班の方\r\nAND ISNULL(a.HYNO,\'\') not IN (select HYNO from FHD010  where  BBH in (\'0868\') \r\nOR  BBH between \'963\' and \'996\' or BBH between \'1037\' and \'1070\' ) \r\n--⑯熊本県、大分県由布市在住の方 \r\nand a.HYNO not in ( select HYNO from ZK_DONOTDELETE where qf in(\'001\',\'008\'))\r\n                        AND A.HYNO NOT IN (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH in (\'V25D\',\'V25E\',\'V25F\',\'V25G\',\'V25H\'))\r\n', null, '0', null);
INSERT INTO `sn_task_detail` VALUES ('36', '38', 'DL', 'SELECT \r\ndistinct A.hyno \r\nFROM  CALL010 A    \r\nLEFT JOIN FMD060 D ON A.HYNO=D.HYNO    \r\nLEFT JOIN FHD030 E ON A.HYNO=E.HYNO  \r\nWHERE\r\n\r\nA.HYNO in \r\n(select  a.HYNO   from FHD010 a  \r\nleft join fhd030 b on a.hyno=b.hyno \r\nwhere a.ccbh between \'4639\' and \'4647\' and b.PHASE in (\'11\',\'13\')) \r\n                        \r\nAND ISNULL(A.HYNO,\'\') not in (select distinct HYNO from FMD200 )  \r\nAND A.HYNO NOT IN ( SELECT DISTINCT SLNKAINO  FROM FMD070 WHERE  ISNULL(SLNDELDT,\'\')<>\'00000000\') \r\nAND A.HYZB<>\'B\' AND SUBSTRING (A.HYNO,1,1) <>\'4\'    \r\nAND isnull(D.zjgrr,\'\') < \'20160401\'  \r\nAND ISNULL(a.SNYR,\'\')>\'19361231\'  \r\nAND ISNULL(A.HYNO,\'\') NOT IN (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH=\'H49H\')   \r\nand ISNULL(a.HYNO,\'\') not in (select HYNO from CALL010 where SALONNO=\'008631\' and XZDW = \'10\')\r\nand a.salonno not in (\'005271\',\'009302\',\'000516\',\'006538\',\'007432\',\'009272\') \r\nand ISNULL(a.HYNO,\'\') not in (select distinct hyno from FMD180EXCEL2 where ccbh in (\'0059\',\'0054\'))  \r\nand ISNULL(a.HYNO,\'\')<>\'0553968\'\r\nAND SUBSTRING ( rtrim(ltrim(A.HYM)),1,1)<>\'☆\'  \r\nAND ISNULL(a.HYNO,\'\') not IN (select HYNO from FHD010  where  BBH in (\'0868\') \r\nOR  BBH between \'963\' and \'996\' or BBH between \'1037\' and \'1070\' ) \r\nand a.HYNO not in ( select HYNO from ZK_DONOTDELETE where qf in(\'001\',\'008\'))\r\n                        AND A.HYNO NOT IN (SELECT HYNO FROM FMD180EXCEL1 WHERE CCBH in (\'V25D\',\'V25E\',\'V25F\',\'V25G\',\'V25H\'))\r\n', null, '0', null);
INSERT INTO `sn_task_detail` VALUES ('37', '40', 'A', 'SELECT distinct ', '0', '2', '2016-11-11 15:10:48');
INSERT INTO `sn_task_detail` VALUES ('38', '40', 'B', '   CONVERT(INT,CONVERT(NVARCHAR,ROW_NUMBER()  OVER(PARTITION BY A.SALONNO ORDER BY A.SALONNO))) AS SEQ, ', '0', '2', '2016-11-11 15:19:39');
INSERT INTO `sn_task_detail` VALUES ('39', '40', 'DEL_AB_BAK', '     A.SALONNO555,A.HYNO,A.HYZB,A.HYM,A.HYMKN ,A.CHGRSLNO,ISNULL(C2.SLNMC,\'\')CHSLNMC,ISNULL(B.MC,\'\') ZS,', null, '0', '2016-11-11 15:08:23');
INSERT INTO `sn_task_detail` VALUES ('40', '40', 'AB_BAK', '    A.SNYR,ISNULL(D.ZJGRJE,\'\') ZJGRJE,ISNULL(D.ZJGRR,\'\') ZJGRR,isnull(c.SLNDELDT,\'\'),A.TEL,', null, '0', '2016-11-11 15:08:23');
INSERT INTO `sn_task_detail` VALUES ('41', '40', 'InsertD', '    a.QHYNO,A.QHYM,ISNULL(E.DLDLLQF,\'\') DLDLLQF ,', null, '0', '2016-11-11 15:08:23');
INSERT INTO `sn_task_detail` VALUES ('42', '40', 'D', '    ISNULL(E.ZTQF,\'\') ZTQF ,ISNULL(E.PHASE,\'\') PHASE,E.CCBH,E.QHCALLRS,', '0', '2', '2016-11-11 15:19:39');
INSERT INTO `sn_task_detail` VALUES ('43', '40', 'InsertE', ' A.BLOCKNO,F.MC', null, '0', '2016-11-11 15:08:23');
INSERT INTO `sn_task_detail` VALUES ('44', '40', 'E', 'FROM  CALL010 A ', '0', '2', '2016-11-11 15:19:39');
INSERT INTO `sn_task_detail` VALUES ('45', '40', 'InsertF', 'LEFT JOIN FMD010 A0 ON A.HYNO =A0.HYNO ', null, '0', '2016-11-11 15:08:23');
INSERT INTO `sn_task_detail` VALUES ('46', '40', 'F', 'LEFT JOIN FMD080 B ON  A.DDFXBH=B.ID', '0', '2', '2016-11-11 15:19:39');
INSERT INTO `sn_task_detail` VALUES ('47', '40', 'InsertG', 'LEFT JOIN FMD070 C ON A.SALONNO=C.SLNCD', null, '0', '2016-11-11 15:08:23');
INSERT INTO `sn_task_detail` VALUES ('48', '40', 'G', 'LEFT JOIN FMD070 C2 ON A.CHGRSLNO =C2.SLNCD', '0', '2', '2016-11-11 15:19:39');
INSERT INTO `sn_task_detail` VALUES ('49', '40', 'InsertH', 'LEFT JOIN FMD060 D ON A.HYNO=D.HYNO ', null, '0', '2016-11-11 15:08:23');
INSERT INTO `sn_task_detail` VALUES ('50', '40', 'H', 'LEFT JOIN FHD030 E ON A.HYNO=E.HYNO ', '0', '2', '2016-11-11 15:19:39');
INSERT INTO `sn_task_detail` VALUES ('51', '40', 'AH', 'LEFT JOIN FMD110 F ON A.BLOCKNO = F.MCKEY AND F.GLBH = \'004\' ', '0', '2', '2016-11-11 15:19:39');
INSERT INTO `sn_task_detail` VALUES ('52', '40', 'DL', 'WHERE --抽出コード4639～4647の最新コール結果が「OK」と「不在」の方を抽出してしてください', null, '0', '2016-11-11 15:08:23');
INSERT INTO `sn_task_detail` VALUES ('53', '0', '', 'A.HYNO in ', null, null, null);
INSERT INTO `sn_task_detail` VALUES ('54', '0', '', '(select  a.HYNO   from FHD010 a  ', null, null, null);
INSERT INTO `sn_task_detail` VALUES ('55', '0', '', 'left join fhd030 b on a.hyno=b.hyno ', null, null, null);
INSERT INTO `sn_task_detail` VALUES ('56', '0', '', 'where a.ccbh between \'4639\' and \'4647\' and b.PHASE in (\'11\',\'13\')) ', null, null, null);
